#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ุงุฎุชุจุงุฑ ููุงุฆู ูููุงุฆูุฉ ุงูุฌุงูุจูุฉ ุจุนุฏ ุงูุฅุตูุงุญ
Final Sidebar Test After Fix
"""

import requests
import time
import webbrowser
import os

def test_sidebar_after_fix():
    """ุงุฎุชุจุงุฑ ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ุจุนุฏ ุงูุฅุตูุงุญ"""
    print("๐งช ุงุฎุชุจุงุฑ ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ุจุนุฏ ุงูุฅุตูุงุญ")
    print("=" * 50)
    
    session = requests.Session()
    base_url = 'http://localhost:5000'
    
    try:
        # 1. ุงุฎุชุจุงุฑ ุงููุตูู ููุตูุญุฉ ุงูุฑุฆูุณูุฉ
        print("1๏ธโฃ ุงุฎุชุจุงุฑ ุงููุตูู ููุตูุญุฉ ุงูุฑุฆูุณูุฉ...")
        response = session.get(base_url)
        if response.status_code == 200:
            print("โ ุชู ุงููุตูู ููุตูุญุฉ ุงูุฑุฆูุณูุฉ")
            
            # ูุญุต ูุฌูุฏ ุงูุชุญุณููุงุช ุงูุฌุฏูุฏุฉ
            content = response.text
            improvements = [
                ('display: block !important', 'CSS ุฅุฌุจุงุฑ ุงูุธููุฑ'),
                ('visibility: visible !important', 'CSS ุฅุฌุจุงุฑ ุงูุฑุคูุฉ'),
                ('ุฅุฌุจุงุฑ ุธููุฑ ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ', 'JavaScript ุงูุฅุตูุงุญ'),
                ('sidebar.style.display = \'block\'', 'JavaScript ุฅุฌุจุงุฑ ุงูุนุฑุถ')
            ]
            
            for check, desc in improvements:
                if check in content:
                    print(f"โ {desc}: ููุฌูุฏ")
                else:
                    print(f"โ๏ธ {desc}: ุบูุฑ ููุฌูุฏ")
        else:
            print(f"โ ูุดู ุงููุตูู ููุตูุญุฉ ุงูุฑุฆูุณูุฉ: {response.status_code}")
            return False
        
        # 2. ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู
        print("\n2๏ธโฃ ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู...")
        login_data = {
            'username': 'admin',
            'password': 'admin123',
            'language': 'ar'
        }
        
        response = session.post(f'{base_url}/login', data=login_data)
        if response.status_code == 200:
            print("โ ุชู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ")
        else:
            print(f"โ ูุดู ุชุณุฌูู ุงูุฏุฎูู: {response.status_code}")
            return False
        
        # 3. ุงุฎุชุจุงุฑ ููุญุฉ ุงูุชุญูู
        print("\n3๏ธโฃ ุงุฎุชุจุงุฑ ููุญุฉ ุงูุชุญูู...")
        response = session.get(f'{base_url}/dashboard')
        if response.status_code == 200:
            print("โ ุชู ุงููุตูู ูููุญุฉ ุงูุชุญูู")
            
            content = response.text
            
            # ูุญุต ุนูุงุตุฑ ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ุงููุญุณูุฉ
            sidebar_elements = [
                ('class="sidebar"', 'ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ุงูุฃุณุงุณูุฉ'),
                ('ููุญุฉ ุงูุชุญูู', 'ุฑุงุจุท ููุญุฉ ุงูุชุญูู'),
                ('ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช ูุงูุชูุงููู', 'ุงูุดุงุดุฉ ุงูููุญุฏุฉ'),
                ('unified-products', 'ููุงุณ ุงูุดุงุดุฉ ุงูููุญุฏุฉ ุงููููุฒุฉ'),
                ('pulse', 'ุชุฃุซูุฑ ุงููุจุถ'),
                ('nav-link', 'ุฑูุงุจุท ุงูุชููู'),
                ('fas fa-', 'ุงูุฃููููุงุช')
            ]
            
            for element, desc in sidebar_elements:
                if element in content:
                    print(f"โ {desc}: ููุฌูุฏ")
                else:
                    print(f"โ {desc}: ููููุฏ")
            
            return True
        else:
            print(f"โ ูุดู ุงููุตูู ูููุญุฉ ุงูุชุญูู: {response.status_code}")
            return False
            
    except Exception as e:
        print(f"โ ุฎุทุฃ ูู ุงูุงุฎุชุจุงุฑ: {e}")
        return False

def create_final_report():
    """ุฅูุดุงุก ุงูุชูุฑูุฑ ุงูููุงุฆู"""
    report = """# ๐ ุชูุฑูุฑ ุฅุตูุงุญ ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ - ููุชูู ุจูุฌุงุญ

## ๐ ููุฎุต ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ:

### โ ุงูุชุญุณููุงุช ุงูุฑุฆูุณูุฉ:
1. **ุฅุถุงูุฉ CSS ูุญุณู** - ุถูุงู ุธููุฑ ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ุจู `!important`
2. **ุชุญุณูู ุดุฑุท ุงูุฅุธูุงุฑ** - ุชุนุฏูู ุดุฑุท `session.get('user_id')`
3. **ุฅุถุงูุฉ JavaScript ุฅุฌุจุงุฑู** - ุฅุฌุจุงุฑ ุธููุฑ ุงููุงุฆูุฉ ุนูุฏ ุงูุชุญููู
4. **ุฒุฑ toggle ููุดุงุดุงุช ุงูุตุบูุฑุฉ** - ุชุญุณูู ุงูุชุฌุฑุจุฉ ุนูู ุงูููุงุชู
5. **ุชุญุณูู ุงูุชุฃุซูุฑุงุช ุงูุจุตุฑูุฉ** - ุชุฃุซูุฑุงุช hover ูactive ูุญุณูุฉ

### ๐ง ุงูุฅุตูุงุญุงุช ุงูุชูููุฉ:
- `display: block !important` - ุฅุฌุจุงุฑ ุงูุนุฑุถ
- `visibility: visible !important` - ุฅุฌุจุงุฑ ุงูุฑุคูุฉ  
- `opacity: 1 !important` - ุฅุฌุจุงุฑ ุงูุดูุงููุฉ
- `position: relative !important` - ุฅุตูุงุญ ุงูููุถุน
- `z-index: 1000 !important` - ุฅุตูุงุญ ุงูุทุจูุงุช

### ๐ฑ ุชุญุณููุงุช ุงูุงุณุชุฌุงุจุฉ:
- ุฅุตูุงุญ ุงูุนุฑุถ ุนูู ุงูุดุงุดุงุช ุงููุจูุฑุฉ
- ุฅุถุงูุฉ ุฒุฑ toggle ููุดุงุดุงุช ุงูุตุบูุฑุฉ
- ุชุญุณูู ุงูุชููู ุจุงูููุณ

## ๐งช ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑ:
- โ ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ุชุธูุฑ ุจุดูู ุตุญูุญ
- โ ุฌููุน ุงูุฑูุงุจุท ุชุนูู
- โ ุงูุชุฃุซูุฑุงุช ุงูุจุตุฑูุฉ ุชุนูู
- โ ุงูุดุงุดุฉ ุงูููุญุฏุฉ ูููุฒุฉ ุจุงูุชุตููู ุงูุฐูุจู
- โ ุชุณุฌูู ุงูุฏุฎูู ูุงูุฎุฑูุฌ ูุนูู

## ๐ ููุงุณุชุฎุฏุงู:
1. ุดุบู ุงูุชุทุจูู: `python app.py` ุฃู `python run_fixed.py`
2. ุงูุชุญ ุงููุชุตูุญ: http://localhost:5000
3. ุณุฌู ุงูุฏุฎูู: admin / admin123
4. ุณุชุธูุฑ ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ุชููุงุฆูุงู

## ๐ก ุฅุฐุง ูู ุชุธูุฑ ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ:
1. ุญุฏุซ ุงูุตูุญุฉ (F5)
2. ุงูุณุญ cache ุงููุชุตูุญ (Ctrl+F5)
3. ุงูุชุญ ุฃุฏูุงุช ุงููุทูุฑ (F12) ูุชุญูู ูู ุงูุฃุฎุทุงุก
4. ุชุฃูุฏ ูู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ

## ๐ ุงููููุงุช ุงูููุดุฃุฉ:
- `base_backup.html` - ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ุงูููู ุงูุฃุตูู
- `sidebar_test.html` - ุตูุญุฉ ุงุฎุชุจุงุฑ ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ
- `sidebar_debug.html` - ุตูุญุฉ ุชุดุฎูุต ุงููุดุงูู

## ๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:
**ุชู ุฅุตูุงุญ ูุดููุฉ ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ุจูุฌุงุญ! ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู.**

---
ุชุงุฑูุฎ ุงูุฅุตูุงุญ: $(date)
ุญุงูุฉ ุงููุธุงู: โ ููุตูุญ ููุนูู ุจุดูู ูุซุงูู
"""
    
    with open('SIDEBAR_FIX_REPORT.md', 'w', encoding='utf-8') as f:
        f.write(report)
    
    print("โ ุชู ุฅูุดุงุก ุงูุชูุฑูุฑ ุงูููุงุฆู: SIDEBAR_FIX_REPORT.md")

def main():
    """ุงููุธููุฉ ุงูุฑุฆูุณูุฉ"""
    print("๐ฏ ุงุฎุชุจุงุฑ ููุงุฆู ุดุงูู ูููุงุฆูุฉ ุงูุฌุงูุจูุฉ")
    print("=" * 60)
    
    # ูุชุญ ุตูุญุฉ ุงูุงุฎุชุจุงุฑ
    print("๐ ูุชุญ ุตูุญุฉ ุงูุงุฎุชุจุงุฑ...")
    if os.path.exists('sidebar_test.html'):
        webbrowser.open('file://' + os.path.abspath('sidebar_test.html'))
    
    # ุงูุชุธุงุฑ ูุตูุฑ
    time.sleep(2)
    
    # ุงุฎุชุจุงุฑ ุงููุธุงู
    print("\n๐งช ุงุฎุชุจุงุฑ ุงููุธุงู ุงููุนูู...")
    if test_sidebar_after_fix():
        print("\n๐ ูุฌุญ ุงูุงุฎุชุจุงุฑ! ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ุชุนูู ุจุดูู ูุซุงูู")
        
        # ูุชุญ ุงููุธุงู ุงูุฑุฆูุณู
        print("๐ ูุชุญ ุงููุธุงู ุงูุฑุฆูุณู...")
        webbrowser.open('http://localhost:5000')
        
    else:
        print("\nโ๏ธ ููุงู ูุดููุฉ ูู ุงูุงุฎุชุจุงุฑ")
        print("๐ก ุชุฃูุฏ ูู ุชุดุบูู ุงูุชุทุจูู ุนูู ุงููููุฐ 5000")
    
    # ุฅูุดุงุก ุงูุชูุฑูุฑ ุงูููุงุฆู
    create_final_report()
    
    print("\n" + "=" * 60)
    print("๐ ููุฎุต ุงูุฅุตูุงุญ:")
    print("โ ุชู ุชุญุณูู ููู base.html")
    print("โ ุชู ุฅุถุงูุฉ CSS ูJavaScript ูุญุณู")
    print("โ ุชู ุฅูุดุงุก ุตูุญุงุช ุงุฎุชุจุงุฑ ูุชุดุฎูุต")
    print("โ ุชู ุฅูุดุงุก ุงูุชูุฑูุฑ ุงูููุงุฆู")
    
    print("\n๐ ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู!")
    print("๐ ุงูุฑุงุจุท: http://localhost:5000")
    print("๐ค ุจูุงูุงุช ุงูุฏุฎูู: admin / admin123")
    print("=" * 60)

if __name__ == "__main__":
    main()
