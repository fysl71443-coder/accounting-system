{% extends "base_unified.html" %}

{% block title %}
    {% if session.get('language', 'ar') == 'ar' %}
        إدارة المخزون - نظام المحاسبة
    {% else %}
        Inventory Management - Accounting System
    {% endif %}
{% endblock %}

{% block page_icon %}<i class="fas fa-boxes"></i>{% endblock %}

{% block page_title %}
{% if session.get('language', 'ar') == 'ar' %}
    إدارة المخزون
{% else %}
    Inventory Management
{% endif %}
{% endblock %}

{% block content %}

<!-- Inventory Statistics -->
<div class="row g-3 mb-4">
    <div class="col-xl-3 col-md-6">
        <div class="card h-100">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-uppercase mb-1 text-muted small">
                            {% if session.get('language', 'ar') == 'ar' %}إجمالي الأصناف{% else %}Total Items{% endif %}
                        </h6>
                        <h4 class="mb-0 text-primary">1,245</h4>
                    </div>
                    <div class="text-primary opacity-75">
                        <i class="fas fa-box fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-md-6">
        <div class="card h-100">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-uppercase mb-1 text-muted small">
                            {% if session.get('language', 'ar') == 'ar' %}مخزون منخفض{% else %}Low Stock{% endif %}
                        </h6>
                        <h4 class="mb-0 text-danger">23</h4>
                    </div>
                    <div class="text-danger opacity-75">
                        <i class="fas fa-arrow-down fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-md-6">
        <div class="card h-100">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-uppercase mb-1 text-muted small">
                            {% if session.get('language', 'ar') == 'ar' %}نفد المخزون{% else %}Out of Stock{% endif %}
                        </h6>
                        <h4 class="mb-0 text-warning">8</h4>
                    </div>
                    <div class="text-warning opacity-75">
                        <i class="fas fa-times-circle fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-md-6">
        <div class="card h-100">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-uppercase mb-1 text-muted small">
                            {% if session.get('language', 'ar') == 'ar' %}قيمة المخزون{% else %}Inventory Value{% endif %}
                        </h6>
                        <h4 class="mb-0 text-success">2,450,000</h4>
                    </div>
                    <div class="text-success opacity-75">
                        <i class="fas fa-dollar-sign fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Search and Filter -->
<div class="card mb-4">
    <div class="card-body">
        <div class="row g-3">
            <div class="col-md-6">
                <div class="input-group">
                    <input type="text" class="form-control" id="searchItems" placeholder="{% if session.get('language', 'ar') == 'ar' %}البحث في الأصناف...{% else %}Search items...{% endif %}">
                    <button class="btn btn-outline-secondary" type="button">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
    <div class="col-md-2">
        <select class="form-select" id="filterCategory">
            <option value="">{% if session.get('language', 'ar') == 'ar' %}جميع الفئات{% else %}All Categories{% endif %}</option>
            <option value="electronics">إلكترونيات</option>
            <option value="food">أغذية</option>
            <option value="clothing">ملابس</option>
            <option value="books">كتب</option>
        </select>
    </div>
    <div class="col-md-2">
        <select class="form-select" id="filterStock">
            <option value="">{% if session.get('language', 'ar') == 'ar' %}جميع المخزون{% else %}All Stock{% endif %}</option>
            <option value="in_stock">متوفر</option>
            <option value="low_stock">مخزون منخفض</option>
            <option value="out_of_stock">نفد المخزون</option>
        </select>
    </div>
    <div class="col-md-2">
        <select class="form-select" id="sortBy">
            <option value="name">{% if session.get('language', 'ar') == 'ar' %}ترتيب بالاسم{% else %}Sort by Name{% endif %}</option>
            <option value="stock">{% if session.get('language', 'ar') == 'ar' %}ترتيب بالمخزون{% else %}Sort by Stock{% endif %}</option>
            <option value="price">{% if session.get('language', 'ar') == 'ar' %}ترتيب بالسعر{% else %}Sort by Price{% endif %}</option>
        </select>
    </div>
    <div class="col-md-2">
        <div class="btn-group w-100" role="group">
            <button type="button" class="btn btn-outline-secondary" onclick="toggleView('table')" id="tableViewBtn">
                <i class="fas fa-table"></i>
            </button>
            <button type="button" class="btn btn-outline-secondary active" onclick="toggleView('cards')" id="cardsViewBtn">
                <i class="fas fa-th"></i>
            </button>
        </div>
    </div>
</div>

<!-- Inventory Table View -->
<div class="card d-none" id="tableView">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>{% if session.get('language', 'ar') == 'ar' %}الصورة{% else %}Image{% endif %}</th>
                        <th>{% if session.get('language', 'ar') == 'ar' %}اسم الصنف{% else %}Item Name{% endif %}</th>
                        <th>{% if session.get('language', 'ar') == 'ar' %}الفئة{% else %}Category{% endif %}</th>
                        <th>{% if session.get('language', 'ar') == 'ar' %}الكمية{% else %}Quantity{% endif %}</th>
                        <th>{% if session.get('language', 'ar') == 'ar' %}الوحدة{% else %}Unit{% endif %}</th>
                        <th>{% if session.get('language', 'ar') == 'ar' %}سعر الشراء{% else %}Purchase Price{% endif %}</th>
                        <th>{% if session.get('language', 'ar') == 'ar' %}سعر البيع{% else %}Selling Price{% endif %}</th>
                        <th>{% if session.get('language', 'ar') == 'ar' %}الحالة{% else %}Status{% endif %}</th>
                        <th>{% if session.get('language', 'ar') == 'ar' %}إجراءات{% else %}Actions{% endif %}</th>
                    </tr>
                </thead>
                <tbody id="inventoryTableBody">
                    <!-- Sample inventory data -->
                    <tr>
                        <td>
                            <img src="https://via.placeholder.com/50x50/007bff/ffffff?text=PC" alt="كمبيوتر محمول" class="rounded" style="width: 50px; height: 50px;">
                        </td>
                        <td>
                            <strong>كمبيوتر محمول HP</strong><br>
                            <small class="text-muted">HP Pavilion 15</small>
                        </td>
                        <td><span class="badge bg-primary">إلكترونيات</span></td>
                        <td><strong>25</strong></td>
                        <td>قطعة</td>
                        <td><strong>3,200 ريال</strong></td>
                        <td><strong>3,500 ريال</strong></td>
                        <td><span class="badge bg-success">متوفر</span></td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="viewItem(1)" title="عرض">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-warning" onclick="editItem(1)" title="تعديل">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-info" onclick="adjustStock(1)" title="تعديل المخزون">
                                    <i class="fas fa-boxes"></i>
                                </button>
                                <button class="btn btn-outline-secondary" onclick="viewHistory(1)" title="التاريخ">
                                    <i class="fas fa-history"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <img src="https://via.placeholder.com/50x50/28a745/ffffff?text=📱" alt="هاتف ذكي" class="rounded" style="width: 50px; height: 50px;">
                        </td>
                        <td>
                            <strong>هاتف ذكي Samsung</strong><br>
                            <small class="text-muted">Galaxy S21</small>
                        </td>
                        <td><span class="badge bg-primary">إلكترونيات</span></td>
                        <td><strong class="text-warning">5</strong></td>
                        <td>قطعة</td>
                        <td><strong>2,800 ريال</strong></td>
                        <td><strong>3,200 ريال</strong></td>
                        <td><span class="badge bg-warning">مخزون منخفض</span></td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="viewItem(2)" title="عرض">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-warning" onclick="editItem(2)" title="تعديل">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-info" onclick="adjustStock(2)" title="تعديل المخزون">
                                    <i class="fas fa-boxes"></i>
                                </button>
                                <button class="btn btn-outline-secondary" onclick="viewHistory(2)" title="التاريخ">
                                    <i class="fas fa-history"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <img src="https://via.placeholder.com/50x50/dc3545/ffffff?text=📚" alt="كتاب" class="rounded" style="width: 50px; height: 50px;">
                        </td>
                        <td>
                            <strong>كتاب البرمجة</strong><br>
                            <small class="text-muted">تعلم البرمجة بسهولة</small>
                        </td>
                        <td><span class="badge bg-info">كتب</span></td>
                        <td><strong class="text-danger">0</strong></td>
                        <td>قطعة</td>
                        <td><strong>45.00 ريال</strong></td>
                        <td><strong>80.00 ريال</strong></td>
                        <td><span class="badge bg-danger">نفد المخزون</span></td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="viewItem(3)" title="عرض">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-warning" onclick="editItem(3)" title="تعديل">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-info" onclick="adjustStock(3)" title="تعديل المخزون">
                                    <i class="fas fa-boxes"></i>
                                </button>
                                <button class="btn btn-outline-secondary" onclick="viewHistory(3)" title="التاريخ">
                                    <i class="fas fa-history"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <img src="https://via.placeholder.com/50x50/ffc107/000000?text=👕" alt="قميص" class="rounded" style="width: 50px; height: 50px;">
                        </td>
                        <td>
                            <strong>قميص قطني</strong><br>
                            <small class="text-muted">قميص رجالي أزرق</small>
                        </td>
                        <td><span class="badge bg-secondary">ملابس</span></td>
                        <td><strong>50</strong></td>
                        <td>قطعة</td>
                        <td><strong>85.00 ريال</strong></td>
                        <td><strong>120.00 ريال</strong></td>
                        <td><span class="badge bg-success">متوفر</span></td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="viewItem(4)" title="عرض">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-warning" onclick="editItem(4)" title="تعديل">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-info" onclick="adjustStock(4)" title="تعديل المخزون">
                                    <i class="fas fa-boxes"></i>
                                </button>
                                <button class="btn btn-outline-secondary" onclick="viewHistory(4)" title="التاريخ">
                                    <i class="fas fa-history"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <img src="https://via.placeholder.com/50x50/17a2b8/ffffff?text=🍎" alt="تفاح" class="rounded" style="width: 50px; height: 50px;">
                        </td>
                        <td>
                            <strong>تفاح أحمر</strong><br>
                            <small class="text-muted">تفاح طازج من المزرعة</small>
                        </td>
                        <td><span class="badge bg-success">أغذية</span></td>
                        <td><strong>200</strong></td>
                        <td>كيلو</td>
                        <td><strong>8.00 ريال</strong></td>
                        <td><strong>12.00 ريال</strong></td>
                        <td><span class="badge bg-success">متوفر</span></td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="viewItem(5)" title="عرض">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-warning" onclick="editItem(5)" title="تعديل">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-info" onclick="adjustStock(5)" title="تعديل المخزون">
                                    <i class="fas fa-boxes"></i>
                                </button>
                                <button class="btn btn-outline-secondary" onclick="viewHistory(5)" title="التاريخ">
                                    <i class="fas fa-history"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Inventory Cards View -->
<div class="row" id="cardsView">
    <!-- Sample Inventory Cards -->
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="card inventory-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h6 class="card-title mb-0">iPhone 14 Pro</h6>
                <span class="badge bg-success">متوفر</span>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-4">
                        <img src="https://via.placeholder.com/80x80" class="img-fluid rounded" alt="iPhone 14 Pro">
                    </div>
                    <div class="col-8">
                        <div class="row">
                            <div class="col-12 mb-1">
                                <small class="text-muted">
                                    {% if session.get('language', 'ar') == 'ar' %}الفئة:{% else %}Category:{% endif %}
                                </small>
                                <span class="badge bg-primary">إلكترونيات</span>
                            </div>
                            <div class="col-6 mb-1">
                                <small class="text-muted">
                                    {% if session.get('language', 'ar') == 'ar' %}الكمية:{% else %}Qty:{% endif %}
                                </small>
                                <br><strong>25</strong>
                            </div>
                            <div class="col-6 mb-1">
                                <small class="text-muted">
                                    {% if session.get('language', 'ar') == 'ar' %}الوحدة:{% else %}Unit:{% endif %}
                                </small>
                                <br>قطعة
                            </div>
                            <div class="col-6 mb-1">
                                <small class="text-muted">
                                    {% if session.get('language', 'ar') == 'ar' %}سعر الشراء:{% else %}Purchase:{% endif %}
                                </small>
                                <br><strong>3,200 ريال</strong>
                            </div>
                            <div class="col-6 mb-1">
                                <small class="text-muted">
                                    {% if session.get('language', 'ar') == 'ar' %}سعر البيع:{% else %}Selling:{% endif %}
                                </small>
                                <br><strong>3,500 ريال</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <div class="btn-group w-100" role="group">
                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="viewItem(1)">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-warning" onclick="editItem(1)">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-success" onclick="adjustStock(1)">
                        <i class="fas fa-plus-minus"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-info" onclick="viewHistory(1)">
                        <i class="fas fa-history"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6 col-lg-4 mb-4">
        <div class="card inventory-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h6 class="card-title mb-0">برياني دجاج</h6>
                <span class="badge bg-warning">مخزون منخفض</span>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-4">
                        <img src="https://via.placeholder.com/80x80" class="img-fluid rounded" alt="برياني دجاج">
                    </div>
                    <div class="col-8">
                        <div class="row">
                            <div class="col-12 mb-1">
                                <small class="text-muted">
                                    {% if session.get('language', 'ar') == 'ar' %}الفئة:{% else %}Category:{% endif %}
                                </small>
                                <span class="badge bg-success">أغذية</span>
                            </div>
                            <div class="col-6 mb-1">
                                <small class="text-muted">
                                    {% if session.get('language', 'ar') == 'ar' %}الكمية:{% else %}Qty:{% endif %}
                                </small>
                                <br><strong class="text-warning">5</strong>
                            </div>
                            <div class="col-6 mb-1">
                                <small class="text-muted">
                                    {% if session.get('language', 'ar') == 'ar' %}الوحدة:{% else %}Unit:{% endif %}
                                </small>
                                <br>طبق
                            </div>
                            <div class="col-6 mb-1">
                                <small class="text-muted">
                                    {% if session.get('language', 'ar') == 'ar' %}سعر الشراء:{% else %}Purchase:{% endif %}
                                </small>
                                <br><strong>15.50 ريال</strong>
                            </div>
                            <div class="col-6 mb-1">
                                <small class="text-muted">
                                    {% if session.get('language', 'ar') == 'ar' %}سعر البيع:{% else %}Selling:{% endif %}
                                </small>
                                <br><strong>25.00 ريال</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <div class="btn-group w-100" role="group">
                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="viewItem(2)">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-warning" onclick="editItem(2)">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-success" onclick="adjustStock(2)">
                        <i class="fas fa-plus-minus"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-info" onclick="viewHistory(2)">
                        <i class="fas fa-history"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6 col-lg-4 mb-4">
        <div class="card inventory-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h6 class="card-title mb-0">قميص قطني أزرق</h6>
                <span class="badge bg-danger">نفد المخزون</span>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-4">
                        <img src="https://via.placeholder.com/80x80" class="img-fluid rounded" alt="قميص قطني">
                    </div>
                    <div class="col-8">
                        <div class="row">
                            <div class="col-12 mb-1">
                                <small class="text-muted">
                                    {% if session.get('language', 'ar') == 'ar' %}الفئة:{% else %}Category:{% endif %}
                                </small>
                                <span class="badge bg-info">ملابس</span>
                            </div>
                            <div class="col-6 mb-1">
                                <small class="text-muted">
                                    {% if session.get('language', 'ar') == 'ar' %}الكمية:{% else %}Qty:{% endif %}
                                </small>
                                <br><strong class="text-danger">0</strong>
                            </div>
                            <div class="col-6 mb-1">
                                <small class="text-muted">
                                    {% if session.get('language', 'ar') == 'ar' %}الوحدة:{% else %}Unit:{% endif %}
                                </small>
                                <br>قطعة
                            </div>
                            <div class="col-6 mb-1">
                                <small class="text-muted">
                                    {% if session.get('language', 'ar') == 'ar' %}سعر الشراء:{% else %}Purchase:{% endif %}
                                </small>
                                <br><strong>45.00 ريال</strong>
                            </div>
                            <div class="col-6 mb-1">
                                <small class="text-muted">
                                    {% if session.get('language', 'ar') == 'ar' %}سعر البيع:{% else %}Selling:{% endif %}
                                </small>
                                <br><strong>80.00 ريال</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <div class="btn-group w-100" role="group">
                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="viewItem(3)">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-warning" onclick="editItem(3)">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-success" onclick="adjustStock(3)">
                        <i class="fas fa-plus-minus"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-info" onclick="viewHistory(3)">
                        <i class="fas fa-history"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Item Modal -->
<div class="modal fade" id="addItemModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    {% if session.get('language', 'ar') == 'ar' %}إضافة صنف جديد{% else %}Add New Item{% endif %}
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="itemForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">
                                {% if session.get('language', 'ar') == 'ar' %}اسم الصنف{% else %}Item Name{% endif %}
                            </label>
                            <input type="text" class="form-control" name="item_name" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">
                                {% if session.get('language', 'ar') == 'ar' %}الفئة{% else %}Category{% endif %}
                            </label>
                            <select class="form-select" name="category" required>
                                <option value="">{% if session.get('language', 'ar') == 'ar' %}اختر الفئة{% else %}Select Category{% endif %}</option>
                                <option value="electronics">إلكترونيات</option>
                                <option value="food">أغذية</option>
                                <option value="clothing">ملابس</option>
                                <option value="books">كتب</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">
                                {% if session.get('language', 'ar') == 'ar' %}الكمية الابتدائية{% else %}Initial Quantity{% endif %}
                            </label>
                            <input type="number" class="form-control" name="initial_quantity" min="0" step="0.01">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">
                                {% if session.get('language', 'ar') == 'ar' %}الوحدة{% else %}Unit{% endif %}
                            </label>
                            <select class="form-select" name="unit">
                                <option value="قطعة">قطعة</option>
                                <option value="كيلو">كيلو</option>
                                <option value="لتر">لتر</option>
                                <option value="متر">متر</option>
                                <option value="طبق">طبق</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">
                                {% if session.get('language', 'ar') == 'ar' %}سعر الشراء{% else %}Purchase Price{% endif %}
                            </label>
                            <input type="number" class="form-control" name="purchase_price" step="0.01" min="0">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">
                                {% if session.get('language', 'ar') == 'ar' %}سعر البيع{% else %}Selling Price{% endif %}
                            </label>
                            <input type="number" class="form-control" name="selling_price" step="0.01" min="0">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">
                                {% if session.get('language', 'ar') == 'ar' %}الحد الأدنى للمخزون{% else %}Minimum Stock Level{% endif %}
                            </label>
                            <input type="number" class="form-control" name="min_stock" min="0" step="0.01">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">
                                {% if session.get('language', 'ar') == 'ar' %}الحد الأقصى للمخزون{% else %}Maximum Stock Level{% endif %}
                            </label>
                            <input type="number" class="form-control" name="max_stock" min="0" step="0.01">
                        </div>
                        <div class="col-12 mb-3">
                            <label class="form-label">
                                {% if session.get('language', 'ar') == 'ar' %}الوصف{% else %}Description{% endif %}
                            </label>
                            <textarea class="form-control" name="description" rows="3"></textarea>
                        </div>
                        <div class="col-12 mb-3">
                            <label class="form-label">
                                {% if session.get('language', 'ar') == 'ar' %}صورة الصنف{% else %}Item Image{% endif %}
                            </label>
                            <input type="file" class="form-control" name="item_image" accept="image/*">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    {% if session.get('language', 'ar') == 'ar' %}إلغاء{% else %}Cancel{% endif %}
                </button>
                <button type="button" class="btn btn-primary" onclick="saveItem()">
                    {% if session.get('language', 'ar') == 'ar' %}حفظ{% else %}Save{% endif %}
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Stock Adjustment Modal -->
<div class="modal fade" id="stockAdjustmentModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    {% if session.get('language', 'ar') == 'ar' %}تعديل المخزون{% else %}Stock Adjustment{% endif %}
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="stockAdjustmentForm">
                    <div class="mb-3">
                        <label class="form-label">
                            {% if session.get('language', 'ar') == 'ar' %}نوع التعديل{% else %}Adjustment Type{% endif %}
                        </label>
                        <select class="form-select" name="adjustment_type" required>
                            <option value="add">{% if session.get('language', 'ar') == 'ar' %}إضافة{% else %}Add{% endif %}</option>
                            <option value="subtract">{% if session.get('language', 'ar') == 'ar' %}خصم{% else %}Subtract{% endif %}</option>
                            <option value="set">{% if session.get('language', 'ar') == 'ar' %}تعيين{% else %}Set{% endif %}</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">
                            {% if session.get('language', 'ar') == 'ar' %}الكمية{% else %}Quantity{% endif %}
                        </label>
                        <input type="number" class="form-control" name="quantity" step="0.01" min="0" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">
                            {% if session.get('language', 'ar') == 'ar' %}السبب{% else %}Reason{% endif %}
                        </label>
                        <select class="form-select" name="reason">
                            <option value="purchase">{% if session.get('language', 'ar') == 'ar' %}شراء{% else %}Purchase{% endif %}</option>
                            <option value="sale">{% if session.get('language', 'ar') == 'ar' %}بيع{% else %}Sale{% endif %}</option>
                            <option value="damage">{% if session.get('language', 'ar') == 'ar' %}تلف{% else %}Damage{% endif %}</option>
                            <option value="theft">{% if session.get('language', 'ar') == 'ar' %}سرقة{% else %}Theft{% endif %}</option>
                            <option value="adjustment">{% if session.get('language', 'ar') == 'ar' %}تعديل{% else %}Adjustment{% endif %}</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">
                            {% if session.get('language', 'ar') == 'ar' %}ملاحظات{% else %}Notes{% endif %}
                        </label>
                        <textarea class="form-control" name="notes" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    {% if session.get('language', 'ar') == 'ar' %}إلغاء{% else %}Cancel{% endif %}
                </button>
                <button type="button" class="btn btn-primary" onclick="saveStockAdjustment()">
                    {% if session.get('language', 'ar') == 'ar' %}حفظ{% else %}Save{% endif %}
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Sample inventory data
const inventoryData = [
    {
        id: 1,
        name: 'كمبيوتر محمول HP',
        description: 'HP Pavilion 15',
        category: 'إلكترونيات',
        quantity: 25,
        unit: 'قطعة',
        purchasePrice: 3200,
        sellingPrice: 3500,
        status: 'متوفر',
        statusClass: 'success',
        image: 'https://via.placeholder.com/50x50/007bff/ffffff?text=PC'
    },
    {
        id: 2,
        name: 'هاتف ذكي Samsung',
        description: 'Galaxy S21',
        category: 'إلكترونيات',
        quantity: 5,
        unit: 'قطعة',
        purchasePrice: 2800,
        sellingPrice: 3200,
        status: 'مخزون منخفض',
        statusClass: 'warning',
        image: 'https://via.placeholder.com/50x50/28a745/ffffff?text=📱'
    },
    {
        id: 3,
        name: 'كتاب البرمجة',
        description: 'تعلم البرمجة بسهولة',
        category: 'كتب',
        quantity: 0,
        unit: 'قطعة',
        purchasePrice: 45,
        sellingPrice: 80,
        status: 'نفد المخزون',
        statusClass: 'danger',
        image: 'https://via.placeholder.com/50x50/dc3545/ffffff?text=📚'
    },
    {
        id: 4,
        name: 'قميص قطني',
        description: 'قميص رجالي أزرق',
        category: 'ملابس',
        quantity: 50,
        unit: 'قطعة',
        purchasePrice: 85,
        sellingPrice: 120,
        status: 'متوفر',
        statusClass: 'success',
        image: 'https://via.placeholder.com/50x50/ffc107/000000?text=👕'
    },
    {
        id: 5,
        name: 'تفاح أحمر',
        description: 'تفاح طازج من المزرعة',
        category: 'أغذية',
        quantity: 200,
        unit: 'كيلو',
        purchasePrice: 8,
        sellingPrice: 12,
        status: 'متوفر',
        statusClass: 'success',
        image: 'https://via.placeholder.com/50x50/17a2b8/ffffff?text=🍎'
    }
];

function toggleView(viewType) {
    const tableView = document.getElementById('tableView');
    const cardsView = document.getElementById('cardsView');
    const tableBtn = document.getElementById('tableViewBtn');
    const cardsBtn = document.getElementById('cardsViewBtn');

    if (viewType === 'table') {
        tableView.classList.remove('d-none');
        cardsView.classList.add('d-none');
        tableBtn.classList.add('active');
        cardsBtn.classList.remove('active');

        // Load table data when switching to table view
        loadTableData();
    } else {
        tableView.classList.add('d-none');
        cardsView.classList.remove('d-none');
        tableBtn.classList.remove('active');
        cardsBtn.classList.add('active');
    }
}

function loadTableData() {
    const tbody = document.getElementById('inventoryTableBody');

    // Clear existing data
    tbody.innerHTML = '';

    // Add data rows
    inventoryData.forEach(item => {
        const row = document.createElement('tr');

        const quantityClass = item.quantity === 0 ? 'text-danger' : item.quantity <= 10 ? 'text-warning' : '';
        const categoryBadgeClass = getCategoryBadgeClass(item.category);

        row.innerHTML = `
            <td>
                <img src="${item.image}" alt="${item.name}" class="rounded" style="width: 50px; height: 50px;">
            </td>
            <td>
                <strong>${item.name}</strong><br>
                <small class="text-muted">${item.description}</small>
            </td>
            <td><span class="badge ${categoryBadgeClass}">${item.category}</span></td>
            <td><strong class="${quantityClass}">${item.quantity}</strong></td>
            <td>${item.unit}</td>
            <td><strong>${item.purchasePrice.toFixed(2)} ريال</strong></td>
            <td><strong>${item.sellingPrice.toFixed(2)} ريال</strong></td>
            <td><span class="badge bg-${item.statusClass}">${item.status}</span></td>
            <td>
                <div class="btn-group btn-group-sm">
                    <button class="btn btn-outline-primary" onclick="viewItem(${item.id})" title="عرض">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-outline-warning" onclick="editItem(${item.id})" title="تعديل">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-outline-info" onclick="adjustStock(${item.id})" title="تعديل المخزون">
                        <i class="fas fa-boxes"></i>
                    </button>
                    <button class="btn btn-outline-secondary" onclick="viewHistory(${item.id})" title="التاريخ">
                        <i class="fas fa-history"></i>
                    </button>
                </div>
            </td>
        `;

        tbody.appendChild(row);
    });
}

function getCategoryBadgeClass(category) {
    const categoryClasses = {
        'إلكترونيات': 'bg-primary',
        'كتب': 'bg-info',
        'ملابس': 'bg-secondary',
        'أغذية': 'bg-success'
    };
    return categoryClasses[category] || 'bg-secondary';
}

// Search and filter functionality
function setupSearchAndFilter() {
    const searchInput = document.getElementById('searchItems');
    const categoryFilter = document.getElementById('filterCategory');
    const sortSelect = document.getElementById('sortItems');

    searchInput.addEventListener('input', filterAndSearch);
    categoryFilter.addEventListener('change', filterAndSearch);
    sortSelect.addEventListener('change', filterAndSearch);
}

function filterAndSearch() {
    const searchTerm = document.getElementById('searchItems').value.toLowerCase();
    const selectedCategory = document.getElementById('filterCategory').value;
    const sortBy = document.getElementById('sortItems').value;

    let filteredData = inventoryData.filter(item => {
        const matchesSearch = item.name.toLowerCase().includes(searchTerm) ||
                            item.description.toLowerCase().includes(searchTerm);
        const matchesCategory = !selectedCategory || item.category === selectedCategory;

        return matchesSearch && matchesCategory;
    });

    // Sort data
    if (sortBy === 'name') {
        filteredData.sort((a, b) => a.name.localeCompare(b.name));
    } else if (sortBy === 'quantity') {
        filteredData.sort((a, b) => b.quantity - a.quantity);
    } else if (sortBy === 'price') {
        filteredData.sort((a, b) => b.sellingPrice - a.sellingPrice);
    }

    // Update table if in table view
    if (!document.getElementById('tableView').classList.contains('d-none')) {
        updateTableWithData(filteredData);
    }

    // Update cards view
    updateCardsWithData(filteredData);
}

function updateTableWithData(data) {
    const tbody = document.getElementById('inventoryTableBody');
    tbody.innerHTML = '';

    data.forEach(item => {
        const row = document.createElement('tr');
        const quantityClass = item.quantity === 0 ? 'text-danger' : item.quantity <= 10 ? 'text-warning' : '';
        const categoryBadgeClass = getCategoryBadgeClass(item.category);

        row.innerHTML = `
            <td>
                <img src="${item.image}" alt="${item.name}" class="rounded" style="width: 50px; height: 50px;">
            </td>
            <td>
                <strong>${item.name}</strong><br>
                <small class="text-muted">${item.description}</small>
            </td>
            <td><span class="badge ${categoryBadgeClass}">${item.category}</span></td>
            <td><strong class="${quantityClass}">${item.quantity}</strong></td>
            <td>${item.unit}</td>
            <td><strong>${item.purchasePrice.toFixed(2)} ريال</strong></td>
            <td><strong>${item.sellingPrice.toFixed(2)} ريال</strong></td>
            <td><span class="badge bg-${item.statusClass}">${item.status}</span></td>
            <td>
                <div class="btn-group btn-group-sm">
                    <button class="btn btn-outline-primary" onclick="viewItem(${item.id})" title="عرض">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-outline-warning" onclick="editItem(${item.id})" title="تعديل">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-outline-info" onclick="adjustStock(${item.id})" title="تعديل المخزون">
                        <i class="fas fa-boxes"></i>
                    </button>
                    <button class="btn btn-outline-secondary" onclick="viewHistory(${item.id})" title="التاريخ">
                        <i class="fas fa-history"></i>
                    </button>
                </div>
            </td>
        `;
        tbody.appendChild(row);
    });
}

function updateCardsWithData(data) {
    // This would update the cards view - for now we'll keep the existing cards
    console.log('Cards view updated with', data.length, 'items');
}

function viewItem(id) {
    const item = inventoryData.find(item => item.id === id);
    if (item) {
        alert(`عرض تفاصيل الصنف: ${item.name}\nالكمية: ${item.quantity} ${item.unit}\nسعر البيع: ${item.sellingPrice} ريال`);
    }
}

function editItem(id) {
    const item = inventoryData.find(item => item.id === id);
    if (item) {
        alert(`تعديل الصنف: ${item.name}\nالكمية الحالية: ${item.quantity} ${item.unit}`);
    }
}

function adjustStock(id) {
    // Show stock adjustment modal
    const modal = new bootstrap.Modal(document.getElementById('stockAdjustmentModal'));
    modal.show();
}

function viewHistory(id) {
    alert('عرض تاريخ حركة المخزون للصنف رقم: ' + id);
}

function saveItem() {
    const form = document.getElementById('itemForm');
    const formData = new FormData(form);
    
    alert('تم حفظ الصنف بنجاح');
    
    const modal = bootstrap.Modal.getInstance(document.getElementById('addItemModal'));
    modal.hide();
    form.reset();
}

function saveStockAdjustment() {
    const form = document.getElementById('stockAdjustmentForm');
    const formData = new FormData(form);
    
    alert('تم تعديل المخزون بنجاح');
    
    const modal = bootstrap.Modal.getInstance(document.getElementById('stockAdjustmentModal'));
    modal.hide();
    form.reset();
}

function exportInventory() {
    alert('تصدير قائمة المخزون');
}

function stockAlert() {
    showToast(isRTL ? 'عرض تنبيهات المخزون المنخفض' : 'Showing low stock alerts', 'info');
}

// Refresh data
function refreshData() {
    const btn = event.target.closest('button');
    const originalText = btn.innerHTML;
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>' + (isRTL ? 'جاري التحديث...' : 'Refreshing...');

    setTimeout(() => {
        btn.disabled = false;
        btn.innerHTML = originalText;
        showToast(isRTL ? 'تم تحديث البيانات بنجاح' : 'Data refreshed successfully', 'success');
    }, 1500);
}

// Generate report
function generateReport() {
    const btn = event.target.closest('button');
    const originalText = btn.innerHTML;
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>' + (isRTL ? 'جاري الإنشاء...' : 'Generating...');

    setTimeout(() => {
        btn.disabled = false;
        btn.innerHTML = originalText;
        showToast(isRTL ? 'تم إنشاء تقرير المخزون بنجاح' : 'Inventory report generated successfully', 'success');
    }, 1500);
}

// Save all data
function saveAllData() {
    const btn = event.target.closest('button');
    const originalText = btn.innerHTML;
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>' + (isRTL ? 'جاري الحفظ...' : 'Saving...');

    setTimeout(() => {
        btn.disabled = false;
        btn.innerHTML = originalText;
        showToast(isRTL ? 'تم حفظ جميع البيانات بنجاح' : 'All data saved successfully', 'success');
    }, 1500);
}

// Print report
function printReport() {
    showToast(isRTL ? 'جاري إعداد التقرير للطباعة...' : 'Preparing report for printing...', 'info');
    setTimeout(() => {
        window.print();
    }, 1000);
}

// Initialize page when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    console.log('🔄 Initializing inventory page...');

    // Setup search and filter functionality
    setupSearchAndFilter();

    // Load initial table data (if table view is active)
    if (!document.getElementById('tableView').classList.contains('d-none')) {
        loadTableData();
    }

    console.log('✅ Inventory page initialized successfully');
});
</script>
{% endblock %}
