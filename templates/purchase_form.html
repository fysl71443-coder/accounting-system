{% extends "base_unified.html" %}

{% block title %}ุฅุถุงูุฉ ูุงุชูุฑุฉ ูุดุชุฑูุงุช - ูุธุงู ุงููุญุงุณุจุฉ{% endblock %}
{% block page_title %}ุฅุถุงูุฉ ูุงุชูุฑุฉ ูุดุชุฑูุงุช ุฌุฏูุฏุฉ{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-plus me-2"></i>
            ุฅุถุงูุฉ ูุงุชูุฑุฉ ูุดุชุฑูุงุช ุฌุฏูุฏุฉ
        </h5>
    </div>
    <div class="card-body">
        <form id="purchaseForm" method="POST" action="/api/purchases/create">
            <div class="row">
                <!-- ูุนูููุงุช ุงููุงุชูุฑุฉ ุงูุฃุณุงุณูุฉ -->
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="invoiceNumber" class="form-label">ุฑูู ุงููุงุชูุฑุฉ</label>
                        <input type="text" class="form-control" id="invoiceNumber" name="invoice_number" 
                               value="ุณูุชู ุฅูุดุงุคู ุชููุงุฆูุงู" readonly>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="invoiceDate" class="form-label">ุชุงุฑูุฎ ุงููุงุชูุฑุฉ</label>
                        <input type="date" class="form-control" id="invoiceDate" name="invoice_date" 
                               value="{{ today }}" required>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="supplierName" class="form-label">ุงุณู ุงูููุฑุฏ</label>
                        <input type="text" class="form-control" id="supplierName" name="supplier_name" 
                               placeholder="ุฃุฏุฎู ุงุณู ุงูููุฑุฏ" required>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="supplierPhone" class="form-label">ูุงุชู ุงูููุฑุฏ</label>
                        <input type="tel" class="form-control" id="supplierPhone" name="supplier_phone" 
                               placeholder="ุฑูู ุงููุงุชู">
                    </div>
                </div>
            </div>

            <!-- ุชูุงุตูู ุงูุฃุตูุงู -->
            <div class="card mt-4">
                <div class="card-header">
                    <h6 class="mb-0">ุชูุงุตูู ุงูุฃุตูุงู</h6>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered" id="itemsTable">
                            <thead>
                                <tr>
                                    <th>ุงูุตูู</th>
                                    <th>ุงููููุฉ</th>
                                    <th>ุณุนุฑ ุงููุญุฏุฉ</th>
                                    <th>ุงูุฅุฌูุงูู</th>
                                    <th>ุฅุฌุฑุงุกุงุช</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <input type="text" class="form-control" name="item_name[]" 
                                               placeholder="ุงุณู ุงูุตูู" required>
                                    </td>
                                    <td>
                                        <input type="number" class="form-control quantity" name="quantity[]" 
                                               placeholder="ุงููููุฉ" min="1" value="1" required>
                                    </td>
                                    <td>
                                        <input type="number" class="form-control price" name="unit_price[]" 
                                               placeholder="ุงูุณุนุฑ" step="0.01" min="0" required>
                                    </td>
                                    <td>
                                        <input type="number" class="form-control total" name="item_total[]" 
                                               placeholder="ุงูุฅุฌูุงูู" readonly>
                                    </td>
                                    <td>
                                        <button type="button" class="btn btn-danger btn-sm remove-item">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button type="button" class="btn btn-success btn-sm" id="addItem">
                        <i class="fas fa-plus me-1"></i>ุฅุถุงูุฉ ุตูู
                    </button>
                </div>
            </div>

            <!-- ุงูุฅุฌูุงููุงุช -->
            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="notes" class="form-label">ููุงุญุธุงุช</label>
                        <textarea class="form-control" id="notes" name="notes" rows="3" 
                                  placeholder="ุฃู ููุงุญุธุงุช ุฅุถุงููุฉ"></textarea>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-6">
                                    <strong>ุงูุฅุฌูุงูู ุงููุฑุนู:</strong>
                                </div>
                                <div class="col-6 text-end">
                                    <span id="subtotal">0.00</span> ุฑูุงู
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <strong>ุงูุถุฑูุจุฉ (15%):</strong>
                                </div>
                                <div class="col-6 text-end">
                                    <span id="tax">0.00</span> ุฑูุงู
                                </div>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-6">
                                    <strong>ุงูุฅุฌูุงูู ุงูููุงุฆู:</strong>
                                </div>
                                <div class="col-6 text-end">
                                    <strong><span id="grandTotal">0.00</span> ุฑูุงู</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ุฃุฒุฑุงุฑ ุงูุญูุธ -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="d-flex justify-content-between">
                        <a href="/purchases" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-1"></i>ุงูุนูุฏุฉ
                        </a>
                        <div>
                            <button type="button" class="btn btn-info me-2" id="previewBtn">
                                <i class="fas fa-eye me-1"></i>ูุนุงููุฉ
                            </button>
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-save me-1"></i>ุญูุธ ุงููุงุชูุฑุฉ
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('๐ ุชุญููู ูููุฐุฌ ุฅุถุงูุฉ ูุงุชูุฑุฉ ูุดุชุฑูุงุช');
    
    // ุญุณุงุจ ุงูุฅุฌูุงููุงุช
    function calculateTotals() {
        let subtotal = 0;
        
        document.querySelectorAll('#itemsTable tbody tr').forEach(row => {
            const quantity = parseFloat(row.querySelector('.quantity').value) || 0;
            const price = parseFloat(row.querySelector('.price').value) || 0;
            const total = quantity * price;
            
            row.querySelector('.total').value = total.toFixed(2);
            subtotal += total;
        });
        
        const tax = subtotal * 0.15;
        const grandTotal = subtotal + tax;
        
        document.getElementById('subtotal').textContent = subtotal.toFixed(2);
        document.getElementById('tax').textContent = tax.toFixed(2);
        document.getElementById('grandTotal').textContent = grandTotal.toFixed(2);
    }
    
    // ุฅุถุงูุฉ ุตูู ุฌุฏูุฏ
    document.getElementById('addItem').addEventListener('click', function() {
        const tbody = document.querySelector('#itemsTable tbody');
        const newRow = tbody.rows[0].cloneNode(true);
        
        // ูุณุญ ุงูููู
        newRow.querySelectorAll('input').forEach(input => {
            if (input.type !== 'number') {
                input.value = '';
            } else {
                input.value = input.classList.contains('quantity') ? '1' : '0';
            }
        });
        
        tbody.appendChild(newRow);
        
        // ุฑุจุท ุงูุฃุญุฏุงุซ ููุตู ุงูุฌุฏูุฏ
        bindRowEvents(newRow);
    });
    
    // ุฑุจุท ุฃุญุฏุงุซ ุงูุตู
    function bindRowEvents(row) {
        row.querySelectorAll('.quantity, .price').forEach(input => {
            input.addEventListener('input', calculateTotals);
        });
        
        row.querySelector('.remove-item').addEventListener('click', function() {
            if (document.querySelectorAll('#itemsTable tbody tr').length > 1) {
                row.remove();
                calculateTotals();
            } else {
                alert('ูุฌุจ ุฃู ูููู ููุงู ุตูู ูุงุญุฏ ุนูู ุงูุฃูู');
            }
        });
    }
    
    // ุฑุจุท ุงูุฃุญุฏุงุซ ููุตู ุงูุฃูู
    bindRowEvents(document.querySelector('#itemsTable tbody tr'));
    
    // ูุนุงููุฉ ุงููุงุชูุฑุฉ
    document.getElementById('previewBtn').addEventListener('click', function() {
        alert('๐ ูุนุงููุฉ ุงููุงุชูุฑุฉ - ููุฏ ุงูุชุทููุฑ');
    });
    
    // ุญูุธ ุงููุงุชูุฑุฉ
    document.getElementById('purchaseForm').addEventListener('submit', function(e) {
        e.preventDefault();
        alert('๐พ ุญูุธ ูุงุชูุฑุฉ ุงููุดุชุฑูุงุช - ููุฏ ุงูุชุทููุฑ');
    });
    
    console.log('โ ุชู ุชุญููู ูููุฐุฌ ุงููุดุชุฑูุงุช ุจูุฌุงุญ');
});
</script>
{% endblock %}
