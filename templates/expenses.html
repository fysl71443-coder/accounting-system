{% extends "base_unified.html" %}

{% block title %}
{% if session.get('language', 'ar') == 'ar' %}
Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª - Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©
{% else %}
Expenses - Accounting System
{% endif %}
{% endblock %}

{% block page_icon %}<i class="fas fa-receipt"></i>{% endblock %}

{% block page_title %}
{% if session.get('language', 'ar') == 'ar' %}Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª{% else %}Expenses Management{% endif %}
{% endblock %}

{% block page_actions %}
<div class="btn-group">
    <button type="button" class="btn btn-success" id="addExpenseBtn">
        <i class="fas fa-plus me-1"></i>
        {% if session.get('language', 'ar') == 'ar' %}Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯{% else %}Add New Expense{% endif %}
    </button>
    <button type="button" class="btn btn-warning" id="editExpenseBtn">
        <i class="fas fa-edit me-1"></i>
        {% if session.get('language', 'ar') == 'ar' %}ØªØ¹Ø¯ÙŠÙ„{% else %}Edit{% endif %}
    </button>
    <button type="button" class="btn btn-danger" id="deleteExpenseBtn">
        <i class="fas fa-trash me-1"></i>
        {% if session.get('language', 'ar') == 'ar' %}Ø­Ø°Ù{% else %}Delete{% endif %}
    </button>
    <button type="button" class="btn btn-info" id="exportExpenseBtn">
        <i class="fas fa-download me-1"></i>
        {% if session.get('language', 'ar') == 'ar' %}ØªØµØ¯ÙŠØ±{% else %}Export{% endif %}
    </button>
    <button type="button" class="btn btn-secondary" id="printExpenseBtn">
        <i class="fas fa-print me-1"></i>
        {% if session.get('language', 'ar') == 'ar' %}Ø·Ø¨Ø§Ø¹Ø©{% else %}Print{% endif %}
    </button>
</div>
{% endblock %}

{% block content %}

<!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª - Ù†Ø³Ø®Ø© Ù…Ø¨Ø³Ø·Ø© ØªØ¹Ù…Ù„ -->
<div class="card mb-4">
    <div class="card-body">
        <h5 class="card-title">ğŸ”§ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</h5>
        <div class="btn-group mb-3">
            <button type="button" class="btn btn-success" id="addBtn">
                <i class="fas fa-plus me-1"></i>Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯
            </button>
            <button type="button" class="btn btn-warning" id="editBtn">
                <i class="fas fa-edit me-1"></i>ØªØ¹Ø¯ÙŠÙ„
            </button>
            <button type="button" class="btn btn-danger" id="deleteBtn">
                <i class="fas fa-trash me-1"></i>Ø­Ø°Ù
            </button>
            <button type="button" class="btn btn-info" id="exportBtn">
                <i class="fas fa-download me-1"></i>ØªØµØ¯ÙŠØ±
            </button>
            <button type="button" class="btn btn-secondary" id="printBtn">
                <i class="fas fa-print me-1"></i>Ø·Ø¨Ø§Ø¹Ø©
            </button>
        </div>
        <div id="buttonResults" class="mt-2"></div>
    </div>
</div>

<!-- Summary Cards -->
<div class="row g-3 mb-4">
    <div class="col-xl-3 col-md-6">
        <div class="card h-100">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-uppercase mb-1 text-muted small">
                            {% if session.get('language', 'ar') == 'ar' %}Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª{% else %}Total Expenses{% endif %}
                        </h6>
                        <h4 class="mb-0 text-danger" id="total-expenses">{{ "%.2f"|format(summary_data.total_expenses) }} Ø±ÙŠØ§Ù„</h4>
                    </div>
                    <div class="text-danger opacity-75">
                        <i class="fas fa-money-bill-wave fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="card h-100">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-uppercase mb-1 text-muted small">
                            {% if session.get('language', 'ar') == 'ar' %}Ù…ØµØ±ÙˆÙØ§Øª Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±{% else %}This Month{% endif %}
                        </h6>
                        <h4 class="mb-0 text-warning" id="month-expenses">{{ "%.2f"|format(summary_data.pending_expenses) }} Ø±ÙŠØ§Ù„</h4>
                    </div>
                    <div class="text-warning opacity-75">
                        <i class="fas fa-calendar-month fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="card h-100">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-uppercase mb-1 text-muted small">
                            {% if session.get('language', 'ar') == 'ar' %}Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª{% else %}Expenses Count{% endif %}
                        </h6>
                        <h4 class="mb-0 text-info" id="expenses-count">{{ summary_data.expenses_count }}</h4>
                    </div>
                    <div class="text-info opacity-75">
                        <i class="fas fa-list fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="card h-100">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-uppercase mb-1 text-muted small">
                            {% if session.get('language', 'ar') == 'ar' %}Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…ØµØ±ÙˆÙ{% else %}Average Expense{% endif %}
                        </h6>
                        <h4 class="mb-0 text-primary" id="avg-expense">
                            {% if summary_data.expenses_count > 0 %}
                                {{ "%.2f"|format(summary_data.total_expenses / summary_data.expenses_count) }} Ø±ÙŠØ§Ù„
                            {% else %}
                                0.00 Ø±ÙŠØ§Ù„
                            {% endif %}
                        </h4>
                    </div>
                    <div class="text-primary opacity-75">
                        <i class="fas fa-chart-line fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Actions -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">
                        <i class="fas fa-tools me-2"></i>
                        {% if session.get('language', 'ar') == 'ar' %}Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª{% else %}Actions{% endif %}
                    </h6>
                </div>
            </div>
            <div class="card-body">
                <!-- Ø£Ø²Ø±Ø§Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙŠØ¯ -->
                <div class="btn-group me-3 mb-2" role="group">
                    <button type="button" class="btn btn-success" onclick="location.href='/expenses/new'" title="Ø¥Ù†Ø´Ø§Ø¡ Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯">
                        <i class="fas fa-plus me-1"></i>
                        Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯
                    </button>
                </div>

                <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
                <div class="btn-group me-3 mb-2" role="group">
                    <button type="button" id="btnExpensesPrint" class="btn btn-primary" onclick="PrintExpensesRecord()" title="Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„Ù…Ø­Ø¯Ø¯">
                        <i class="fas fa-print me-1"></i>
                        Ø·Ø¨Ø§Ø¹Ø©
                    </button>
                    <button type="button" id="btnExpensesPreview" class="btn btn-info" onclick="PreviewExpensesRecord()" title="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„Ù…Ø­Ø¯Ø¯">
                        <i class="fas fa-eye me-1"></i>
                        Ù…Ø¹Ø§ÙŠÙ†Ø©
                    </button>
                </div>

                <div class="btn-group me-3 mb-2" role="group">
                    <button type="button" id="btnExpensesPayment" class="btn btn-success" onclick="RegisterExpensesPayment()" title="ØªØ³Ø¬ÙŠÙ„ Ø¯ÙØ¹Ø© Ù„Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„Ù…Ø­Ø¯Ø¯">
                        <i class="fas fa-money-bill-wave me-1"></i>
                        ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹
                    </button>
                </div>

                <div class="btn-group me-3 mb-2" role="group">
                    <button type="button" id="btnExpensesEdit" class="btn btn-warning" onclick="EditExpensesRecord()" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„Ù…Ø­Ø¯Ø¯">
                        <i class="fas fa-edit me-1"></i>
                        ØªØ¹Ø¯ÙŠÙ„
                    </button>
                    <button type="button" id="btnExpensesDelete" class="btn btn-danger" onclick="DeleteExpensesRecord()" title="Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„Ù…Ø­Ø¯Ø¯">
                        <i class="fas fa-trash me-1"></i>
                        Ø­Ø°Ù
                    </button>
                </div>

                <!-- Ø£Ø²Ø±Ø§Ø± Ø¥Ø¶Ø§ÙÙŠØ© -->
                <div class="btn-group mb-2" role="group">
                    <button type="button" class="btn btn-outline-primary" onclick="location.href='/payments_dues'" title="Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª ÙˆØ§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª">
                        <i class="fas fa-money-check me-1"></i>
                        Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª
                    </button>
                    <button type="button" class="btn btn-outline-info" onclick="exportExpenses()" title="ØªØµØ¯ÙŠØ± Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª">
                        <i class="fas fa-download me-1"></i>
                        ØªØµØ¯ÙŠØ±
                    </button>
                    <button type="button" class="btn btn-outline-secondary" onclick="location.reload()" title="ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª">
                        <i class="fas fa-sync me-1"></i>
                        ØªØ­Ø¯ÙŠØ«
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Filters -->
<div class="card mb-4">
    <div class="card-header">
        <h6 class="mb-0">
            <i class="fas fa-filter me-2"></i>
            {% if session.get('language', 'ar') == 'ar' %}ÙÙ„Ø§ØªØ± Ø§Ù„Ø¨Ø­Ø«{% else %}Search Filters{% endif %}
        </h6>
    </div>
    <div class="card-body">
        <div class="row g-3">
            <div class="col-md-3">
                <label class="form-label small">
                    {% if session.get('language', 'ar') == 'ar' %}Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ{% else %}Expense Type{% endif %}
                </label>
                <select class="form-select" id="expense-type-filter" onchange="applyFilters()">
                    <option value="all">{% if session.get('language', 'ar') == 'ar' %}Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹{% else %}All Types{% endif %}</option>
                    <option value="office">{% if session.get('language', 'ar') == 'ar' %}Ù…ØµØ±ÙˆÙØ§Øª Ù…ÙƒØªØ¨ÙŠØ©{% else %}Office Expenses{% endif %}</option>
                    <option value="transport">{% if session.get('language', 'ar') == 'ar' %}Ù…ÙˆØ§ØµÙ„Ø§Øª{% else %}Transportation{% endif %}</option>
                    <option value="utilities">{% if session.get('language', 'ar') == 'ar' %}Ø®Ø¯Ù…Ø§Øª Ø¹Ø§Ù…Ø©{% else %}Utilities{% endif %}</option>
                    <option value="marketing">{% if session.get('language', 'ar') == 'ar' %}ØªØ³ÙˆÙŠÙ‚{% else %}Marketing{% endif %}</option>
                    <option value="maintenance">{% if session.get('language', 'ar') == 'ar' %}ØµÙŠØ§Ù†Ø©{% else %}Maintenance{% endif %}</option>
                    <option value="other">{% if session.get('language', 'ar') == 'ar' %}Ø£Ø®Ø±Ù‰{% else %}Other{% endif %}</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label small">
                    {% if session.get('language', 'ar') == 'ar' %}Ù…Ù† ØªØ§Ø±ÙŠØ®{% else %}From Date{% endif %}
                </label>
                <input type="date" class="form-control" id="date-from-filter" onchange="applyFilters()">
            </div>
            <div class="col-md-2">
                <label class="form-label small">
                    {% if session.get('language', 'ar') == 'ar' %}Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®{% else %}To Date{% endif %}
                </label>
                <input type="date" class="form-control" id="date-to-filter" onchange="applyFilters()">
            </div>
            <div class="col-md-2">
                <label class="form-label small">
                    {% if session.get('language', 'ar') == 'ar' %}Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹{% else %}Payment Method{% endif %}
                </label>
                <select class="form-select" id="payment-method-filter" onchange="applyFilters()">
                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ø±Ù‚</option>
                    <option value="cash">Ù†Ù‚Ø¯ÙŠ</option>
                    <option value="bank">Ø¨Ù†ÙƒÙŠ</option>
                    <option value="card">Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†</option>
                </select>
            </div>
            <div class="col-md-1">
                <label class="form-label small">&nbsp;</label>
                <button type="button" class="btn btn-primary w-100" onclick="applyFilters()">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            <div class="col-md-1">
                <label class="form-label small">&nbsp;</label>
                <button type="button" class="btn btn-outline-secondary w-100" onclick="clearFilters()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Expenses Table -->
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h6 class="mb-0">
            <i class="fas fa-table me-2"></i>
            {% if session.get('language', 'ar') == 'ar' %}Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª{% else %}Expenses List{% endif %}
        </h6>
        <div class="d-flex gap-2">
            <input type="text" class="form-control form-control-sm" id="search-input" placeholder="{% if session.get('language', 'ar') == 'ar' %}Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ÙˆØµÙØŒ Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ØŒ Ø§Ù„Ù…ÙˆØ±Ø¯...{% else %}Search in description, reference, vendor...{% endif %}" onkeyup="searchExpenses()">
            <div id="search-results" class="small text-muted mt-1"></div>
        </div>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0" id="expenses-table">
                <thead>
                    <tr>
                        <th style="width: 50px;">
                            {% if session.get('language', 'ar') == 'ar' %}ØªØ­Ø¯ÙŠØ¯{% else %}Select{% endif %}
                        </th>
                        <th>{% if session.get('language', 'ar') == 'ar' %}Ø±Ù‚Ù… Ø§Ù„Ù…ØµØ±ÙˆÙ{% else %}Expense ID{% endif %}</th>
                        <th>{% if session.get('language', 'ar') == 'ar' %}Ø§Ù„ØªØ§Ø±ÙŠØ®{% else %}Date{% endif %}</th>
                        <th>{% if session.get('language', 'ar') == 'ar' %}Ø§Ù„Ù†ÙˆØ¹{% else %}Type{% endif %}</th>
                        <th>{% if session.get('language', 'ar') == 'ar' %}Ø§Ù„ÙˆØµÙ{% else %}Description{% endif %}</th>
                        <th>{% if session.get('language', 'ar') == 'ar' %}Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹{% else %}Payment Status{% endif %}</th>
                        <th>{% if session.get('language', 'ar') == 'ar' %}Ø§Ù„Ù…Ø¨Ù„Øº{% else %}Amount{% endif %}</th>
                        <th>{% if session.get('language', 'ar') == 'ar' %}Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹{% else %}Payment Method{% endif %}</th>
                        <th class="text-center">{% if session.get('language', 'ar') == 'ar' %}Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª{% else %}Actions{% endif %}</th>
                    </tr>
                </thead>
                <tbody id="expenses-tbody">
                    {% if expenses %}
                        {% for expense in expenses %}
                        <tr>
                            <td class="text-center">
                                <input type="radio" name="selected_expense" value="{{ expense.id }}"
                                       data-expense-number="{{ expense.expense_number or ('#EXP-' + expense.id|string) }}"
                                       class="form-check-input">
                            </td>
                            <td>
                                <div class="d-flex flex-column">
                                    <strong class="text-primary">{{ expense.expense_number or ('#EXP-' + expense.id|string) }}</strong>
                                    <small class="text-muted">ID: {{ expense.id }}</small>
                                </div>
                            </td>
                            <td>{{ expense.date.strftime('%Y-%m-%d') if expense.date else '-' }}</td>
                            <td><span class="badge bg-primary">{{ expense.expense_type or expense.category or 'Ø¹Ø§Ù…' }}</span></td>
                            <td>
                                <div class="d-flex flex-column">
                                    <span class="fw-bold">{{ expense.description or 'Ø¨Ø¯ÙˆÙ† ÙˆØµÙ' }}</span>
                                    {% if expense.notes %}
                                    <small class="text-muted">{{ expense.notes }}</small>
                                    {% endif %}
                                </div>
                            </td>
                            <td>
                                {% if expense.payment_status == 'paid' %}
                                    <span class="badge bg-success">Ù…Ø¯ÙÙˆØ¹</span>
                                {% elif expense.payment_status == 'partial' %}
                                    <span class="badge bg-warning">Ù…Ø¯ÙÙˆØ¹ Ø¬Ø²Ø¦ÙŠØ§Ù‹</span>
                                {% else %}
                                    <span class="badge bg-danger">ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹</span>
                                {% endif %}
                            </td>
                            <td class="text-end"><strong>{{ "%.2f"|format(expense.amount) }} Ø±ÙŠØ§Ù„</strong></td>
                            <td>{{ expense.payment_method or '-' }}</td>
                            <td>
                                <div class="btn-group btn-group-sm">
                                    {% if expense.payment_status != 'paid' %}
                                    <button type="button" class="btn btn-primary btn-sm" onclick="location.href='/payments/new?invoice=expense_{{ expense.id }}'" title="Ø¯ÙØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ">
                                        <i class="fas fa-money-bill-wave"></i>
                                    </button>
                                    {% endif %}
                                    <form method="POST" action="/expenses/delete/{{ expense.id }}" style="display: inline;" onsubmit="return confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ {{ expense.expense_number }}ØŸ\\n\\nØ³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹!')">
                                        <button type="submit" class="btn btn-danger btn-sm" title="Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="9" class="text-center text-muted">
                                {% if session.get('language', 'ar') == 'ar' %}Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ±ÙˆÙØ§Øª Ù…Ø­ÙÙˆØ¸Ø©{% else %}No saved expenses{% endif %}
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Expense Modal -->
<div class="modal fade" id="expenseModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    {% if session.get('language', 'ar') == 'ar' %}Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯{% else %}Add New Expense{% endif %}
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="expenseForm" class="expenses-form" data-auto-save="/api/expenses/create" data-method="POST">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">
                                {% if session.get('language', 'ar') == 'ar' %}Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ{% else %}Expense Type{% endif %} *
                            </label>
                            <select class="form-select" id="expenseType" required>
                                <option value="">{% if session.get('language', 'ar') == 'ar' %}Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹{% else %}Select Type{% endif %}</option>
                                <option value="office">{% if session.get('language', 'ar') == 'ar' %}Ù…ØµØ±ÙˆÙØ§Øª Ù…ÙƒØªØ¨ÙŠØ©{% else %}Office Expenses{% endif %}</option>
                                <option value="transport">{% if session.get('language', 'ar') == 'ar' %}Ù…ÙˆØ§ØµÙ„Ø§Øª{% else %}Transportation{% endif %}</option>
                                <option value="utilities">{% if session.get('language', 'ar') == 'ar' %}Ø®Ø¯Ù…Ø§Øª Ø¹Ø§Ù…Ø©{% else %}Utilities{% endif %}</option>
                                <option value="marketing">{% if session.get('language', 'ar') == 'ar' %}ØªØ³ÙˆÙŠÙ‚{% else %}Marketing{% endif %}</option>
                                <option value="maintenance">{% if session.get('language', 'ar') == 'ar' %}ØµÙŠØ§Ù†Ø©{% else %}Maintenance{% endif %}</option>
                                <option value="other">{% if session.get('language', 'ar') == 'ar' %}Ø£Ø®Ø±Ù‰{% else %}Other{% endif %}</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">
                                {% if session.get('language', 'ar') == 'ar' %}Ø§Ù„Ù…Ø¨Ù„Øº{% else %}Amount{% endif %} *
                            </label>
                            <input type="number" class="form-control" id="expenseAmount" step="0.01" min="0.01" max="10000000" required oninput="validateAmount(this)">
                            <div class="invalid-feedback">Ø§Ù„Ù…Ø¨Ù„Øº Ù…Ø·Ù„ÙˆØ¨ ÙˆÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±</div>
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">
                                {% if session.get('language', 'ar') == 'ar' %}Ø§Ù„ØªØ§Ø±ÙŠØ®{% else %}Date{% endif %} *
                            </label>
                            <input type="date" class="form-control" id="expenseDate" required onchange="validateDate(this)">
                            <div class="invalid-feedback">Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ø·Ù„ÙˆØ¨ ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„</div>
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">
                                {% if session.get('language', 'ar') == 'ar' %}Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹{% else %}Payment Method{% endif %}
                            </label>
                            <select class="form-select" id="expensePaymentMethod">
                                <option value="CASH">{% if session.get('language', 'ar') == 'ar' %}Ù†Ù‚Ø¯ÙŠ{% else %}Cash{% endif %}</option>
                                <option value="BANK">{% if session.get('language', 'ar') == 'ar' %}ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ{% else %}Bank Transfer{% endif %}</option>
                                <option value="CHECK">{% if session.get('language', 'ar') == 'ar' %}Ø´ÙŠÙƒ{% else %}Check{% endif %}</option>
                                <option value="CARD">{% if session.get('language', 'ar') == 'ar' %}Ø¨Ø·Ø§Ù‚Ø©{% else %}Card{% endif %}</option>
                            </select>
                        </div>
                        
                        <div class="col-12">
                            <label class="form-label">
                                {% if session.get('language', 'ar') == 'ar' %}Ø§Ù„ÙˆØµÙ{% else %}Description{% endif %} *
                            </label>
                            <textarea class="form-control" id="expenseDescription" rows="3" required minlength="3" maxlength="500" oninput="validateDescription(this)"></textarea>
                            <div class="invalid-feedback">Ø§Ù„ÙˆØµÙ Ù…Ø·Ù„ÙˆØ¨ ÙˆÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 3 Ùˆ 500 Ø­Ø±Ù</div>
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">
                                {% if session.get('language', 'ar') == 'ar' %}Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹{% else %}Reference Number{% endif %}
                            </label>
                            <input type="text" class="form-control" id="expenseReference">
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">
                                {% if session.get('language', 'ar') == 'ar' %}Ø§Ù„Ù…ÙˆØ±Ø¯/Ø§Ù„Ø¬Ù‡Ø©{% else %}Vendor/Entity{% endif %}
                            </label>
                            <input type="text" class="form-control" id="expenseVendor">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    {% if session.get('language', 'ar') == 'ar' %}Ø¥Ù„ØºØ§Ø¡{% else %}Cancel{% endif %}
                </button>
                <button type="button" class="btn btn-success" onclick="saveExpense()">
                    <i class="fas fa-save me-1"></i>
                    {% if session.get('language', 'ar') == 'ar' %}Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙ{% else %}Save Expense{% endif %}
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
const isRTL = '{{ session.get("language", "ar") }}' === 'ar';

// Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¨Ø³ÙŠØ·Ø© - Ù†Ø³Ø®Ø© Ù…Ù† ØµÙØ­Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙŠ ØªØ¹Ù…Ù„
console.log('ğŸ”§ ØªØ¹Ø±ÙŠÙ Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¨Ø³ÙŠØ·Ø©...');

// Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯
function addExpense() {
    console.log('â• Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©');

    try {
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        const modal = document.getElementById('expenseModal');
        if (!modal) {
            alert('âŒ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…ØµØ±ÙˆÙ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!');
            return;
        }

        // Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        const form = document.getElementById('expenseForm');
        if (form) {
            form.reset();
        }

        // ÙØªØ­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        const modalInstance = new bootstrap.Modal(modal);
        modalInstance.show();

        console.log('âœ… ØªÙ… ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ');
        document.getElementById('buttonResults').innerHTML += '<div class="badge bg-success me-1">âœ… Ø¥Ø¶Ø§ÙØ©</div>';

    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ÙØªØ­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬:', error);
        alert('Ø®Ø·Ø£ ÙÙŠ ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…ØµØ±ÙˆÙ: ' + error.message);
    }
}

// Ø¯Ø§Ù„Ø© ØªØ¹Ø¯ÙŠÙ„ Ù…ØµØ±ÙˆÙ
function editExpense() {
    console.log('âœï¸ Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„');

    const selectedRadio = document.querySelector('input[name="selected_expense"]:checked');
    if (!selectedRadio) {
        alert('âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù…ØµØ±ÙˆÙ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹');
        return;
    }

    const expenseId = selectedRadio.value;
    console.log(`ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙ: ${expenseId}`);
    alert(`âœ… Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙŠØ¹Ù…Ù„! Ø³ÙŠØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙ Ø±Ù‚Ù…: ${expenseId}`);
    document.getElementById('buttonResults').innerHTML += '<div class="badge bg-warning me-1">âœ… ØªØ¹Ø¯ÙŠÙ„</div>';
}

// Ø¯Ø§Ù„Ø© Ø­Ø°Ù Ù…ØµØ±ÙˆÙ
function deleteExpense() {
    console.log('ğŸ—‘ï¸ Ø²Ø± Ø§Ù„Ø­Ø°Ù');

    const selectedRadio = document.querySelector('input[name="selected_expense"]:checked');
    if (!selectedRadio) {
        alert('âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù…ØµØ±ÙˆÙ Ù„Ù„Ø­Ø°Ù Ø£ÙˆÙ„Ø§Ù‹');
        return;
    }

    const expenseId = selectedRadio.value;
    if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ Ø±Ù‚Ù… ${expenseId}ØŸ`)) {
        console.log(`Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ: ${expenseId}`);
        alert(`âœ… Ø²Ø± Ø§Ù„Ø­Ø°Ù ÙŠØ¹Ù…Ù„! Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ Ø±Ù‚Ù…: ${expenseId}`);
        document.getElementById('buttonResults').innerHTML += '<div class="badge bg-danger me-1">âœ… Ø­Ø°Ù</div>';

        // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ø§Ù„Ø­Ø°Ù Ø§Ù„ÙØ¹Ù„ÙŠ Ù‡Ù†Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹
    }
}

// Ø¯Ø§Ù„Ø© ØªØµØ¯ÙŠØ± Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª
function exportExpenses() {
    console.log('ğŸ“¥ Ø²Ø± Ø§Ù„ØªØµØ¯ÙŠØ±');
    alert('âœ… Ø²Ø± Ø§Ù„ØªØµØ¯ÙŠØ± ÙŠØ¹Ù…Ù„!');
    document.getElementById('buttonResults').innerHTML += '<div class="badge bg-info me-1">âœ… ØªØµØ¯ÙŠØ±</div>';

    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ø§Ù„ØªØµØ¯ÙŠØ± Ø§Ù„ÙØ¹Ù„ÙŠ Ù‡Ù†Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹
}

// Ø¯Ø§Ù„Ø© Ø·Ø¨Ø§Ø¹Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª
function printExpenses() {
    console.log('ğŸ–¨ï¸ Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©');
    alert('âœ… Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙŠØ¹Ù…Ù„!');
    document.getElementById('buttonResults').innerHTML += '<div class="badge bg-secondary me-1">âœ… Ø·Ø¨Ø§Ø¹Ø©</div>';

    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ¹Ù„ÙŠ Ù‡Ù†Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹
}

// Notification system
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `alert alert-${type === 'error' ? 'danger' : type === 'success' ? 'success' : 'info'} alert-dismissible fade show position-fixed`;
    notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    notification.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;

    document.body.appendChild(notification);

    setTimeout(() => {
        if (notification.parentNode) {
            notification.remove();
        }
    }, 3000);
}

// Load expense for editing
function loadExpenseForEdit(expenseId) {
    // Find expense data from the table using radio button
    const selectedRadio = document.querySelector(`input[name="selected_expense"][value="${expenseId}"]`);
    if (!selectedRadio) {
        showNotification('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…ØµØ±ÙˆÙ', 'error');
        return;
    }

    const row = selectedRadio.closest('tr');
    const expenseData = {
        id: expenseId,
        expense_number: selectedRadio.dataset.expenseNumber || '',
        date: row.cells[2]?.textContent || '',
        expense_type: row.cells[4]?.textContent?.replace(/[^\w\s]/gi, '') || '',
        description: row.cells[5]?.textContent || '',
        amount: row.cells[7]?.textContent?.replace(/[^\d.]/g, '') || '',
        payment_method: row.cells[8]?.textContent || 'cash',
        vendor: row.cells[6]?.textContent || '',
        notes: ''  // Notes are not displayed in table, will be loaded from server if needed
    };

    if (expenseData) {
        populateEditForm(expenseData);
        const modal = new bootstrap.Modal(document.getElementById('expenseModal'));
        modal.show();
    } else {
        showNotification('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµØ±ÙˆÙ', 'error');
    }
}

// Populate edit form with expense data
function populateEditForm(expense) {
    document.getElementById('expenseType').value = expense.expense_type || '';
    document.getElementById('expenseAmount').value = expense.amount || '';
    document.getElementById('expenseDate').value = expense.date || '';
    document.getElementById('expensePaymentMethod').value = expense.payment_method || 'cash';
    document.getElementById('expenseDescription').value = expense.description || '';
    document.getElementById('expenseReference').value = expense.reference || '';
    document.getElementById('expenseVendor').value = expense.vendor || '';
    document.getElementById('expenseNotes').value = expense.notes || '';

    // Update modal title and button
    const modalTitle = document.querySelector('#expenseModal .modal-title');
    if (modalTitle) {
        modalTitle.textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ù…ØµØ±ÙˆÙ';
    }

    // Store expense ID for update
    document.getElementById('expenseModal').dataset.expenseId = expense.id;
}

// Update expense
function updateExpense() {
    const expenseId = document.getElementById('expenseModal').dataset.expenseId;
    if (!expenseId) {
        showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ØµØ±ÙˆÙ', 'error');
        return;
    }

    const form = document.getElementById('expenseForm');
    if (!form.checkValidity()) {
        form.reportValidity();
        return;
    }

    const formData = new FormData(form);
    const expenseData = Object.fromEntries(formData.entries());

    // Show loading indicator
    const submitBtn = document.querySelector('#expenseModal .btn-primary');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
    submitBtn.disabled = true;

    fetch(`/api/expenses/update/${expenseId}`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(expenseData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification(data.message, 'success');
            const modal = bootstrap.Modal.getInstance(document.getElementById('expenseModal'));
            modal.hide();
            setTimeout(() => location.reload(), 1000);
        } else {
            showNotification('Ø®Ø·Ø£: ' + data.message, 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', 'error');
    })
    .finally(() => {
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
    });
}

// Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ø£Ø²Ø±Ø§Ø±
function PrintExpensesRecord() {
    console.log('ğŸ–¨ï¸ Ø²Ø± Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª ØªÙ… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡');

    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„Ù…Ø­Ø¯Ø¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… radio button
    const selectedRadio = document.querySelector('input[name="selected_expense"]:checked');

    console.log('ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„Ù…Ø­Ø¯Ø¯ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©...');
    console.log('Radio buttons Ù…ÙˆØ¬ÙˆØ¯Ø©:', document.querySelectorAll('input[name="selected_expense"]').length);
    console.log('Radio button Ù…Ø­Ø¯Ø¯:', selectedRadio);

    if (!selectedRadio) {
        showNotification('âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù…ØµØ±ÙˆÙ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© Ø£ÙˆÙ„Ø§Ù‹ Ø¨Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„ØµÙ', 'warning');
        console.log('âŒ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø£ÙŠ Ù…ØµØ±ÙˆÙ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©');

        // Ø¥Ø¸Ù‡Ø§Ø± ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
        const totalRows = document.querySelectorAll('.table tbody tr').length;
        if (totalRows === 0) {
            showNotification('ğŸ“ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ±ÙˆÙØ§Øª Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©. ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø£ÙˆÙ„Ø§Ù‹.', 'info');
        } else {
            showNotification(`ğŸ“‹ ÙŠÙˆØ¬Ø¯ ${totalRows} Ù…ØµØ±ÙˆÙ. Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠ ØµÙ Ù„ØªØ­Ø¯ÙŠØ¯Ù‡ Ø«Ù… Ø§Ø¶ØºØ· Ø·Ø¨Ø§Ø¹Ø©.`, 'info');
        }
        return;
    }

    const expenseId = selectedRadio.value;
    console.log(`ğŸ” ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ØµØ±ÙˆÙ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©: ID=${expenseId}`);

    if (expenseId && expenseId !== '') {
        console.log(`ğŸ–¨ï¸ ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: /print_expense/${expenseId}`);
        window.open(`/print_expense/${expenseId}`, '_blank');
    } else {
        showNotification('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ØµØ±ÙˆÙ', 'error');
        console.log('âŒ Ù…Ø¹Ø±Ù Ø§Ù„Ù…ØµØ±ÙˆÙ ÙØ§Ø±Øº');
    }
}

function PreviewExpensesRecord() {
    const selectedRow = document.querySelector('.table tbody tr.table-active');
    if (!selectedRow) {
        showNotification('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù…ØµØ±ÙˆÙ Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©', 'warning');
        return;
    }

    const expenseId = selectedRow.cells[0]?.textContent?.replace('#', '').trim();
    if (expenseId && !isNaN(expenseId)) {
        window.open(`/preview_expense/${expenseId}`, '_blank');
    } else {
        showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ØµØ±ÙˆÙ', 'error');
    }
}

function RegisterExpensesPayment() {
    const selectedRow = document.querySelector('.table tbody tr.table-active');
    if (!selectedRow) {
        showNotification('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù…ØµØ±ÙˆÙ Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹', 'warning');
        return;
    }

    const expenseId = selectedRow.cells[0]?.textContent?.replace('#', '').trim();
    if (expenseId && !isNaN(expenseId)) {
        location.href = `/payments_dues?expense_id=${expenseId}`;
    } else {
        showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ØµØ±ÙˆÙ', 'error');
    }
}

// ØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¨Ù€ editSelectedExpense()

// OLD FUNCTION - REPLACED
function DeleteExpensesRecord_OLD() {
    console.log('ğŸ—‘ï¸ Ø²Ø± Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª ØªÙ… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡');

    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„Ù…Ø­Ø¯Ø¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… radio button
    const selectedRadio = document.querySelector('input[name="selected_expense"]:checked');

    console.log('ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„Ù…Ø­Ø¯Ø¯...');

    const allRadios = document.querySelectorAll('input[name="selected_expense"]');
    console.log('Radio buttons Ù…ÙˆØ¬ÙˆØ¯Ø©:', allRadios.length);
    console.log('Radio button Ù…Ø­Ø¯Ø¯:', selectedRadio);

    // Ø¥Ø¸Ù‡Ø§Ø± Ø­Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ radio buttons Ù„Ù„ØªØ´Ø®ÙŠØµ
    allRadios.forEach((radio, index) => {
        console.log(`Radio ${index + 1}: value=${radio.value}, checked=${radio.checked}, dataset=${JSON.stringify(radio.dataset)}`);
    });

    if (!selectedRadio) {
        showNotification('âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù…ØµØ±ÙˆÙ Ù„Ù„Ø­Ø°Ù Ø£ÙˆÙ„Ø§Ù‹ Ø¨Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„ØµÙ', 'warning');
        console.log('âŒ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø£ÙŠ Ù…ØµØ±ÙˆÙ');

        // Ø¥Ø¸Ù‡Ø§Ø± ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
        const totalRows = document.querySelectorAll('.table tbody tr').length;
        if (totalRows === 0) {
            showNotification('ğŸ“ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ±ÙˆÙØ§Øª Ù„Ù„Ø­Ø°Ù. ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø£ÙˆÙ„Ø§Ù‹.', 'info');
        } else {
            showNotification(`ğŸ“‹ ÙŠÙˆØ¬Ø¯ ${totalRows} Ù…ØµØ±ÙˆÙ. Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠ ØµÙ Ù„ØªØ­Ø¯ÙŠØ¯Ù‡ Ø«Ù… Ø§Ø¶ØºØ· Ø­Ø°Ù.`, 'info');
        }
        return;
    }

    const expenseId = selectedRadio.value;
    const expenseNumber = selectedRadio.dataset.expenseNumber || `EXP-${expenseId}`;

    console.log(`ğŸ” ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ØµØ±ÙˆÙ: ID=${expenseId}, Number=${expenseNumber}`);

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù† Ø§Ù„Ù…ØµØ±ÙˆÙ Ù…Ù† Ø§Ù„ØµÙ
    const row = selectedRadio.closest('tr');
    const description = row.cells[3]?.textContent?.trim() || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';  // Ø¹Ù…ÙˆØ¯ Ø§Ù„ÙˆØµÙ (Ø§Ù„Ø±Ø§Ø¨Ø¹)
    const amount = row.cells[5]?.textContent?.trim() || '0';  // Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù…Ø¨Ù„Øº (Ø§Ù„Ø³Ø§Ø¯Ø³)

    if (!expenseId || expenseId === '') {
        showNotification('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ØµØ±ÙˆÙ', 'error');
        console.log('âŒ Ù…Ø¹Ø±Ù Ø§Ù„Ù…ØµØ±ÙˆÙ ÙØ§Ø±Øº');
        return;
    }

    // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù Ù…Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
    const confirmMessage = `ğŸ—‘ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ ${expenseNumber}ØŸ\n\nğŸ“ Ø§Ù„ÙˆØµÙ: ${description}\nğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº: ${amount}\n\nâš ï¸ ØªØ­Ø°ÙŠØ±: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡!`;

    if (confirm(confirmMessage)) {
        console.log(`ğŸš€ Ø¨Ø¯Ø¡ Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ: ${expenseId}`);
        deleteExpense(expenseId);
    } else {
        console.log('âŒ ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­Ø°Ù Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
    }
}

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    // Set today's date as default
    document.getElementById('expenseDate').value = new Date().toISOString().split('T')[0];

    // Set date filters to current month
    const today = new Date();
    const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
    document.getElementById('from-date').value = firstDay.toISOString().split('T')[0];
    document.getElementById('to-date').value = today.toISOString().split('T')[0];

    // Load expenses on page load
    loadExpenses();
});

// Refresh data
function refreshData() {
    const btn = event.target.closest('button');
    const originalText = btn.innerHTML;
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>' + (isRTL ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...' : 'Refreshing...');

    setTimeout(() => {
        btn.disabled = false;
        btn.innerHTML = originalText;
        alert(isRTL ? 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­' : 'Data refreshed successfully');
        loadExpenses();
    }, 1500);
}

// Comprehensive validation functions
function validateAmount(input) {
    const amount = parseFloat(input.value);

    if (isNaN(amount) || amount <= 0) {
        input.setCustomValidity('Ø§Ù„Ù…Ø¨Ù„Øº ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±');
        input.classList.add('is-invalid');
    } else if (amount > 10000000) {
        input.setCustomValidity('Ø§Ù„Ù…Ø¨Ù„Øº ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: 10,000,000 Ø±ÙŠØ§Ù„)');
        input.classList.add('is-invalid');
    } else {
        input.setCustomValidity('');
        input.classList.remove('is-invalid');
        input.classList.add('is-valid');
    }
}

function validateDate(input) {
    const selectedDate = new Date(input.value);
    const today = new Date();
    const oneYearAgo = new Date();
    oneYearAgo.setFullYear(today.getFullYear() - 1);

    if (selectedDate > today) {
        input.setCustomValidity('Ø§Ù„ØªØ§Ø±ÙŠØ® Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„');
        input.classList.add('is-invalid');
    } else if (selectedDate < oneYearAgo) {
        input.setCustomValidity('Ø§Ù„ØªØ§Ø±ÙŠØ® Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ø¯Ù… Ù…Ù† Ø³Ù†Ø© ÙˆØ§Ø­Ø¯Ø©');
        input.classList.add('is-invalid');
    } else {
        input.setCustomValidity('');
        input.classList.remove('is-invalid');
        input.classList.add('is-valid');
    }
}

function validateDescription(input) {
    const description = input.value.trim();

    if (description.length < 3) {
        input.setCustomValidity('Ø§Ù„ÙˆØµÙ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ 3 Ø£Ø­Ø±Ù');
        input.classList.add('is-invalid');
    } else if (description.length > 500) {
        input.setCustomValidity('Ø§Ù„ÙˆØµÙ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ«Ø± Ù…Ù† 500 Ø­Ø±Ù');
        input.classList.add('is-invalid');
    } else {
        input.setCustomValidity('');
        input.classList.remove('is-invalid');
        input.classList.add('is-valid');
    }
}

// Comprehensive form validation
function validateExpenseForm() {
    const form = document.getElementById('expenseForm');
    const inputs = form.querySelectorAll('input, textarea, select');
    let isValid = true;

    inputs.forEach(input => {
        if (input.type === 'number' && input.id === 'expenseAmount') {
            validateAmount(input);
        } else if (input.type === 'date') {
            validateDate(input);
        } else if (input.tagName === 'TEXTAREA') {
            validateDescription(input);
        }

        if (!input.checkValidity()) {
            isValid = false;
        }
    });

    return isValid;
}

// Save expense (create or update)
function saveExpense() {
    const expenseId = document.getElementById('expenseModal').dataset.expenseId;

    if (expenseId) {
        // Update existing expense
        updateExpense();
        return;
    }

    // Create new expense
    const type = document.getElementById('expenseType').value;
    const amount = document.getElementById('expenseAmount').value;
    const date = document.getElementById('expenseDate').value;
    const paymentMethod = document.getElementById('expensePaymentMethod').value;
    const description = document.getElementById('expenseDescription').value;
    const reference = document.getElementById('expenseReference').value;
    const vendor = document.getElementById('expenseVendor').value;

    const isRTL = document.documentElement.dir === 'rtl';

    // Comprehensive validation
    if (!validateExpenseForm()) {
        showNotification('ÙŠØ±Ø¬Ù‰ ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬', 'error');
        return;
    }

    const btn = event.target.closest('button');
    const originalText = btn.innerHTML;
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>' + (isRTL ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...' : 'Saving...');

    const expenseData = {
        expense_type: type,
        category: type,  // For backward compatibility
        amount: parseFloat(amount),
        date: date,
        payment_method: paymentMethod,
        description: description.trim(),
        reference: reference.trim(),
        vendor: vendor.trim(),
        notes: document.getElementById('expenseNotes')?.value || ''
    };

    fetch('/api/expenses/create', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(expenseData)
    })
    .then(response => response.json())
    .then(data => {
        btn.disabled = false;
        btn.innerHTML = originalText;

        if (data.success) {
            showNotification(isRTL ? 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙ Ø¨Ù†Ø¬Ø§Ø­ - Ø±Ù‚Ù… Ø§Ù„Ù…ØµØ±ÙˆÙ: ' + data.expense_id : 'Expense saved successfully - Expense ID: ' + data.expense_id, 'success');

            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('expenseModal'));
            modal.hide();

            // Clear form
            document.getElementById('expenseForm').reset();
            document.getElementById('expenseDate').value = new Date().toISOString().split('T')[0];

            // Reload expenses
            loadExpenses();
            updateSummaryCards();
        } else {
            showNotification(isRTL ? 'Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙ: ' + data.message : 'Error saving expense: ' + data.message, 'error');
        }
    })
    .catch(error => {
        btn.disabled = false;
        btn.innerHTML = originalText;
        console.error('Error:', error);
        showNotification(isRTL ? 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…' : 'Connection error', 'error');
    });
}

// Load expenses from new API
function loadExpenses() {
    console.log('ğŸ” Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…...');

    fetch('/api/expenses/list')
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${data.count} Ù…ØµØ±ÙˆÙ`);
            displayExpenses(data.data);
            updateSummaryCards(data.data);
        } else {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª:', data.message);
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ‡Ù…ÙŠØ© ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
            loadSampleExpenses();
        }
    })
    .catch(error => {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„:', error);
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ‡Ù…ÙŠØ© ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
        loadSampleExpenses();
    });
}

// Load sample expenses as fallback
function loadSampleExpenses() {
    console.log('âš ï¸ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆÙ‡Ù…ÙŠØ©');
    const sampleExpenses = [
        {
            id: 1,
            expense_number: 'EXP-001',
            expense_type: 'Ù…ØµØ±ÙˆÙØ§Øª Ø¥Ø¯Ø§Ø±ÙŠØ©',
            description: 'Ù…ØµØ±ÙˆÙ ØªØ¬Ø±ÙŠØ¨ÙŠ',
            amount: 500.00,
            date: new Date().toISOString().split('T')[0],
            payment_method: 'Ù†Ù‚Ø¯ÙŠ',
            payment_status: 'paid'
        }
    ];

    displayExpenses(sampleExpenses);
    updateSummaryCards(sampleExpenses);
}

// Export expenses function
function exportExpenses() {
    console.log('ğŸ“¥ Ø²Ø± ØªØµØ¯ÙŠØ± Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª ØªÙ… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡');

    try {
        showNotification('ğŸ“¥ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ù…Ù„Ù Ø§Ù„ØªØµØ¯ÙŠØ±...', 'info');

        // Get current filter values
        const params = new URLSearchParams();

    const expenseTypeFilter = document.getElementById('expense-type-filter');
    const paymentMethodFilter = document.getElementById('payment-method-filter');
    const dateFromFilter = document.getElementById('date-from-filter');
    const dateToFilter = document.getElementById('date-to-filter');

    if (expenseTypeFilter && expenseTypeFilter.value && expenseTypeFilter.value !== 'all') {
        params.append('expense_type', expenseTypeFilter.value);
    }
    if (paymentMethodFilter && paymentMethodFilter.value) {
        params.append('payment_method', paymentMethodFilter.value);
    }
    if (dateFromFilter && dateFromFilter.value) {
        params.append('date_from', dateFromFilter.value);
    }
    if (dateToFilter && dateToFilter.value) {
        params.append('date_to', dateToFilter.value);
    }

        // Create download link
        const exportUrl = `/api/expenses/export?${params.toString()}`;
        console.log(`ğŸ“¡ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØµØ¯ÙŠØ±: ${exportUrl}`);

        // Create temporary link and trigger download
        const link = document.createElement('a');
        link.href = exportUrl;
        link.download = `expenses_${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        console.log('âœ… ØªÙ… Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª');
        showNotification('ğŸ“¥ ØªÙ… Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª', 'success');

    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª:', error);
        showNotification('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª: ' + error.message, 'error');
    }
}

// Convert data to CSV format
function convertToCSV(data) {
    const headers = ['Ø±Ù‚Ù… Ø§Ù„Ù…ØµØ±ÙˆÙ', 'Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ', 'Ø§Ù„ÙˆØµÙ', 'Ø§Ù„Ù…Ø¨Ù„Øº', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹', 'Ø§Ù„Ø­Ø§Ù„Ø©'];
    const csvRows = [];

    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
    csvRows.push(headers.join(','));

    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    data.forEach(expense => {
        const row = [
            expense.expense_number,
            expense.expense_type,
            `"${expense.description}"`,
            expense.amount,
            expense.date,
            expense.payment_method,
            expense.payment_status
        ];
        csvRows.push(row.join(','));
    });

    return csvRows.join('\n');
}

// Display expenses in table
function displayExpenses(expenses) {
    const tbody = document.getElementById('expenses-tbody');

    if (expenses.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="8" class="text-center text-muted">
                    ${isRTL ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ±ÙˆÙØ§Øª Ù…Ø­ÙÙˆØ¸Ø©' : 'No saved expenses'}
                </td>
            </tr>
        `;
        return;
    }

    tbody.innerHTML = expenses.map(expense => `
        <tr>
            <td><input type="checkbox" class="form-check-input expense-checkbox" data-id="${expense.id}"></td>
            <td><strong>#${expense.id}</strong></td>
            <td>${expense.date}</td>
            <td><span class="badge bg-primary">${getExpenseTypeText(expense.expense_type)}</span></td>
            <td>${expense.description}</td>
            <td>${expense.amount.toFixed(2)} Ø±ÙŠØ§Ù„</td>
            <td>${getPaymentMethodText(expense.payment_method)}</td>
            <td>
                <button class="btn btn-outline-primary btn-sm" onclick="viewExpense(${expense.id})" title="Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙ">
                    <i class="fas fa-eye"></i>
                </button>
            </td>
        </tr>
    `).join('');
}

// Get expense type text
function getExpenseTypeText(type) {
    const types = {
        'office': isRTL ? 'Ù…ØµØ±ÙˆÙØ§Øª Ù…ÙƒØªØ¨ÙŠØ©' : 'Office Expenses',
        'transport': isRTL ? 'Ù…ÙˆØ§ØµÙ„Ø§Øª' : 'Transportation',
        'utilities': isRTL ? 'Ø®Ø¯Ù…Ø§Øª Ø¹Ø§Ù…Ø©' : 'Utilities',
        'marketing': isRTL ? 'ØªØ³ÙˆÙŠÙ‚' : 'Marketing',
        'maintenance': isRTL ? 'ØµÙŠØ§Ù†Ø©' : 'Maintenance',
        'other': isRTL ? 'Ø£Ø®Ø±Ù‰' : 'Other'
    };
    return types[type] || type;
}

// Get payment method text
function getPaymentMethodText(method) {
    const methods = {
        'CASH': isRTL ? 'Ù†Ù‚Ø¯ÙŠ' : 'Cash',
        'BANK': isRTL ? 'ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ' : 'Bank Transfer',
        'CHECK': isRTL ? 'Ø´ÙŠÙƒ' : 'Check',
        'CARD': isRTL ? 'Ø¨Ø·Ø§Ù‚Ø©' : 'Card'
    };
    return methods[method] || method;
}

// Update summary cards
function updateSummaryCards(expenses = []) {
    const totalExpenses = expenses.reduce((sum, exp) => sum + exp.amount, 0);
    const currentMonth = new Date().getMonth();
    const currentYear = new Date().getFullYear();
    const monthExpenses = expenses.filter(exp => {
        const expDate = new Date(exp.date);
        return expDate.getMonth() === currentMonth && expDate.getFullYear() === currentYear;
    }).reduce((sum, exp) => sum + exp.amount, 0);

    const avgExpense = expenses.length > 0 ? totalExpenses / expenses.length : 0;

    document.getElementById('total-expenses').textContent = totalExpenses.toFixed(2) + ' Ø±ÙŠØ§Ù„';
    document.getElementById('month-expenses').textContent = monthExpenses.toFixed(2) + ' Ø±ÙŠØ§Ù„';
    document.getElementById('expenses-count').textContent = expenses.length;
    document.getElementById('avg-expense').textContent = avgExpense.toFixed(2) + ' Ø±ÙŠØ§Ù„';
}

// Filter data
function filterData() {
    // Implementation for filtering
    alert(isRTL ? 'Ø¬Ø§Ø±ÙŠ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±...' : 'Applying filters...');
}

// Clear filters
function clearFilters() {
    document.getElementById('expense-type-filter').value = 'all';
    document.getElementById('from-date').value = '';
    document.getElementById('to-date').value = '';
    document.getElementById('min-amount').value = '';
    document.getElementById('max-amount').value = '';
    filterData();
}

// Search expenses
function searchExpenses() {
    const searchTerm = document.getElementById('search-input').value.trim();

    if (searchTerm.length === 0) {
        // If search is empty, reload all expenses
        loadExpenses();
        return;
    }

    // Build search parameters
    const params = new URLSearchParams({
        search: searchTerm
    });

    // Add filter parameters if they exist
    const expenseTypeFilter = document.getElementById('expense-type-filter');
    const paymentMethodFilter = document.getElementById('payment-method-filter');
    const dateFromFilter = document.getElementById('date-from-filter');
    const dateToFilter = document.getElementById('date-to-filter');

    if (expenseTypeFilter && expenseTypeFilter.value) {
        params.append('expense_type', expenseTypeFilter.value);
    }
    if (paymentMethodFilter && paymentMethodFilter.value) {
        params.append('payment_method', paymentMethodFilter.value);
    }
    if (dateFromFilter && dateFromFilter.value) {
        params.append('date_from', dateFromFilter.value);
    }
    if (dateToFilter && dateToFilter.value) {
        params.append('date_to', dateToFilter.value);
    }

    // Perform search
    fetch(`/api/expenses/search?${params.toString()}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                updateExpensesTable(data.expenses);
                updateSearchResults(data.count);
            } else {
                showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«: ' + data.message, 'error');
            }
        })
        .catch(error => {
            console.error('Search error:', error);
            showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', 'error');
        });
}

// Apply filters
function applyFilters() {
    searchExpenses(); // Use the same search function with filters
}

// Clear filters
function clearFilters() {
    document.getElementById('search-input').value = '';
    const filters = document.querySelectorAll('#expense-type-filter, #payment-method-filter, #date-from-filter, #date-to-filter');
    filters.forEach(filter => {
        if (filter) filter.value = '';
    });
    loadExpenses(); // Reload all expenses
}

// Update search results display
function updateSearchResults(count) {
    const resultsDiv = document.getElementById('search-results');
    if (resultsDiv) {
        resultsDiv.textContent = `ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${count} Ù†ØªÙŠØ¬Ø©`;
    }
}

// Toggle select all
function toggleSelectAll() {
    const selectAll = document.getElementById('select-all');
    const checkboxes = document.querySelectorAll('.expense-checkbox');
    checkboxes.forEach(checkbox => {
        checkbox.checked = selectAll.checked;
    });
}

// Delete selected expenses
function deleteSelected() {
    const selected = document.querySelectorAll('.expense-checkbox:checked');
    if (selected.length === 0) {
        alert(isRTL ? 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…ØµØ±ÙˆÙ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„' : 'Please select at least one expense');
        return;
    }

    if (confirm(isRTL ? `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${selected.length} Ù…ØµØ±ÙˆÙØŸ` : `Are you sure you want to delete ${selected.length} expenses?`)) {
        console.log(`ğŸ—‘ï¸ Ø­Ø°Ù ${selected.length} Ù…ØµØ±ÙˆÙ Ù…Ø­Ø¯Ø¯`);

        let deletedCount = 0;
        let totalCount = selected.length;

        selected.forEach(checkbox => {
            const expenseId = checkbox.value;

            fetch(`/api/expenses/delete/${expenseId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                deletedCount++;

                if (data.success) {
                    console.log(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ ID: ${expenseId}`);
                } else {
                    console.error(`âŒ ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ ID: ${expenseId} - ${data.message}`);
                }

                // Ø¥Ø°Ø§ Ø§Ù†ØªÙ‡Ù‰ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                if (deletedCount === totalCount) {
                    alert(isRTL ? `ØªÙ… Ø­Ø°Ù ${totalCount} Ù…ØµØ±ÙˆÙ Ø¨Ù†Ø¬Ø§Ø­` : `${totalCount} expenses deleted successfully`);
                    loadExpenses(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                }
            })
            .catch(error => {
                deletedCount++;
                console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ ID: ${expenseId}`, error);

                if (deletedCount === totalCount) {
                    alert(isRTL ? 'ØªÙ… Ø­Ø°Ù Ø¨Ø¹Ø¶ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ù…Ø¹ ÙˆØ¬ÙˆØ¯ Ø£Ø®Ø·Ø§Ø¡' : 'Some expenses deleted with errors');
                    loadExpenses();
                }
            });
        });
    }
}

// Edit expense function removed - not needed

// View expense function removed - not needed

// Old editExpense function removed - using loadExpenseForEdit instead

// Print expense
function printExpense(id) {
    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµØ±ÙˆÙ
    const table = document.getElementById('expenses-table');
    const rows = table.querySelectorAll('tbody tr');

    for (let row of rows) {
        const checkbox = row.querySelector('.expense-checkbox');
        if (checkbox && checkbox.dataset.id == id) {
            const cells = row.cells;
            const expenseData = {
                number: cells[1].textContent.trim(),
                date: cells[2].textContent.trim(),
                type: cells[3].textContent.trim(),
                description: cells[4].textContent.trim(),
                status: cells[5].textContent.trim(),
                amount: cells[6].textContent.trim(),
                paymentMethod: cells[7].textContent.trim()
            };

            // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§ÙØ°Ø© Ø·Ø¨Ø§Ø¹Ø©
            const printWindow = window.open('', '_blank');
            const printContent = `
                <!DOCTYPE html>
                <html dir="rtl" lang="ar">
                <head>
                    <meta charset="UTF-8">
                    <title>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…ØµØ±ÙˆÙ ${expenseData.number}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .details { margin: 20px 0; }
                        .detail-row { margin: 10px 0; padding: 5px; border-bottom: 1px solid #eee; }
                        .label { font-weight: bold; display: inline-block; width: 150px; }
                        .value { display: inline-block; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h2>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙ</h2>
                        <h3>${expenseData.number}</h3>
                    </div>
                    <div class="details">
                        <div class="detail-row">
                            <span class="label">Ø±Ù‚Ù… Ø§Ù„Ù…ØµØ±ÙˆÙ:</span>
                            <span class="value">${expenseData.number}</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">Ø§Ù„ØªØ§Ø±ÙŠØ®:</span>
                            <span class="value">${expenseData.date}</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">Ø§Ù„Ù†ÙˆØ¹:</span>
                            <span class="value">${expenseData.type}</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">Ø§Ù„ÙˆØµÙ:</span>
                            <span class="value">${expenseData.description}</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹:</span>
                            <span class="value">${expenseData.status}</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">Ø§Ù„Ù…Ø¨Ù„Øº:</span>
                            <span class="value">${expenseData.amount}</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</span>
                            <span class="value">${expenseData.paymentMethod}</span>
                        </div>
                    </div>
                    <div style="margin-top: 50px; text-align: center; font-size: 12px; color: #666;">
                        ØªÙ… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙÙŠ: ${new Date().toLocaleString('ar-SA')}
                    </div>
                </body>
                </html>
            `;

            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.focus();
            printWindow.print();
            return;
        }
    }

    alert(isRTL ? 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…ØµØ±ÙˆÙ' : 'Expense not found');
}

// Delete single expense
function deleteExpense(id) {
    // Ø­Ø°Ù Ù…Ø¨Ø§Ø´Ø± Ø¨Ø¯ÙˆÙ† ØªØ£ÙƒÙŠØ¯
        console.log(`ğŸ—‘ï¸ Ù…Ø­Ø§ÙˆÙ„Ø© Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ ID: ${id}`);

        // Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø­Ø°Ù Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…
        fetch(`/api/expenses/delete/${id}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            if (data.success) {
                console.log(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ ID: ${id} Ø¨Ù†Ø¬Ø§Ø­`);
                showNotification(`âœ… ${data.message}`, 'success');

                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµÙ Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙÙˆØ±Ø§Ù‹ Ù„ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                const selectedRadio = document.querySelector(`input[name="selected_expense"][value="${id}"]`);
                if (selectedRadio) {
                    const rowToRemove = selectedRadio.closest('tr');
                    if (rowToRemove) {
                        rowToRemove.style.transition = 'opacity 0.5s';
                        rowToRemove.style.opacity = '0';
                        setTimeout(() => {
                            rowToRemove.remove();
                            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                            setTimeout(() => location.reload(), 500);
                        }, 500);
                    }
                } else {
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                    loadExpenses();
                }
            } else {
                console.error(`âŒ ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ: ${data.message}`);
                showNotification(`âŒ Ø®Ø·Ø£: ${data.message}`, 'error');
            }
        })
        .catch(error => {
            console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ ID: ${id}`, error);

            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­Ø°Ù Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… POST method ÙƒØ¨Ø¯ÙŠÙ„
            console.log('ğŸ”„ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­Ø°Ù Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… POST method...');

            fetch(`/expenses/delete/${id}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                }
            })
            .then(response => {
                if (response.ok) {
                    console.log('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… POST method');
                    showNotification(isRTL ? 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ Ø¨Ù†Ø¬Ø§Ø­' : 'Expense deleted successfully', 'success');
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                    window.location.reload();
                } else {
                    throw new Error('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­Ø°Ù');
                }
            })
            .catch(postError => {
                console.error('âŒ ÙØ´Ù„ ÙÙŠ ÙƒÙ„Ø§ Ø§Ù„Ø·Ø±ÙŠÙ‚ØªÙŠÙ†:', postError);
                showNotification(isRTL ? 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„' : 'Connection error', 'error');
            });
        });
}

// Open new expense modal
function openNewExpenseModal() {
    // ÙØªØ­ modal Ø¥Ù†Ø´Ø§Ø¡ Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯
    const modal = document.getElementById('expenseModal');
    if (modal) {
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        document.getElementById('expense-form').reset();
        document.getElementById('expense-id').value = '';
        document.getElementById('expenseModalLabel').textContent = isRTL ? 'Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯' : 'Add New Expense';

        // ÙØªØ­ Ø§Ù„Ù€ modal
        const bsModal = new bootstrap.Modal(modal);
        bsModal.show();
    } else {
        alert(isRTL ? 'Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…ØµØ±ÙˆÙ ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹' : 'Expense form not available');
    }
}

// Duplicate export function removed - using main exportExpenses function
            btn.innerHTML = originalText;
            return;
        }

        let csvContent = 'Ø±Ù‚Ù… Ø§Ù„Ù…ØµØ±ÙˆÙ,Ø§Ù„ØªØ§Ø±ÙŠØ®,Ø§Ù„Ù†ÙˆØ¹,Ø§Ù„ÙˆØµÙ,Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹,Ø§Ù„Ù…Ø¨Ù„Øº,Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹\n';

        rows.forEach(row => {
            if (row.cells.length > 1) { // ØªØ¬Ø§Ù‡Ù„ ØµÙ "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª"
                const cells = row.cells;
                const rowData = [
                    cells[1].textContent.trim(), // Ø±Ù‚Ù… Ø§Ù„Ù…ØµØ±ÙˆÙ
                    cells[2].textContent.trim(), // Ø§Ù„ØªØ§Ø±ÙŠØ®
                    cells[3].textContent.trim(), // Ø§Ù„Ù†ÙˆØ¹
                    cells[4].textContent.trim(), // Ø§Ù„ÙˆØµÙ
                    cells[5].textContent.trim(), // Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹
                    cells[6].textContent.trim(), // Ø§Ù„Ù…Ø¨Ù„Øº
                    cells[7].textContent.trim()  // Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
                ];
                csvContent += rowData.join(',') + '\n';
            }
        });

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', 'expenses_' + new Date().toISOString().split('T')[0] + '.csv');
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        setTimeout(() => {
            btn.disabled = false;
            btn.innerHTML = originalText;
            alert(isRTL ? 'ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø¨Ù†Ø¬Ø§Ø­' : 'Expenses exported successfully');
        }, 1000);
    } catch (error) {
        console.error('Export error:', error);
        btn.disabled = false;
        btn.innerHTML = originalText;
        alert(isRTL ? 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµØ¯ÙŠØ±' : 'Export error occurred');
    }
}

// Refresh expenses
function refreshExpenses() {
    const btn = event.target.closest('button');
    const originalText = btn.innerHTML;
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>' + (isRTL ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...' : 'Refreshing...');

    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    setTimeout(() => {
        window.location.reload();
    }, 500);
}

// Generate report
function generateReport() {
    const btn = event.target.closest('button');
    const originalText = btn.innerHTML;
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>' + (isRTL ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...' : 'Generating...');

    setTimeout(() => {
        btn.disabled = false;
        btn.innerHTML = originalText;
        alert(isRTL ? 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø¨Ù†Ø¬Ø§Ø­' : 'Expenses report generated successfully');
    }, 1500);
}

// Export data
function exportData() {
    const btn = event.target.closest('button');
    const originalText = btn.innerHTML;
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>' + (isRTL ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±...' : 'Exporting...');

    setTimeout(() => {
        btn.disabled = false;
        btn.innerHTML = originalText;
        alert(isRTL ? 'ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­' : 'Data exported successfully');
    }, 1500);
}

// Save all data
function saveAllData() {
    const btn = event.target.closest('button');
    const originalText = btn.innerHTML;
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>' + (isRTL ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...' : 'Saving...');

    setTimeout(() => {
        btn.disabled = false;
        btn.innerHTML = originalText;
        alert(isRTL ? 'ØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­' : 'All data saved successfully');
    }, 1500);
}

// Print report
function printReport() {
    alert(isRTL ? 'Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©...' : 'Preparing report for printing...');
    window.print();
}

// ÙˆØ¸ÙŠÙØ© Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙ
function viewExpense(expenseId) {
    const row = document.querySelector(`tr[data-expense-id="${expenseId}"]`);
    if (row) {
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙˆÙ
        document.querySelectorAll('.table tbody tr').forEach(r => r.classList.remove('table-active'));
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù„Ù„ØµÙ Ø§Ù„Ù…Ø­Ø¯Ø¯
        row.classList.add('table-active');

        // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù‡Ù†Ø§
        showNotification(`ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ØµØ±ÙˆÙ #${expenseId}`, 'info');
    }
}

// ÙˆØ¸ÙŠÙØ© Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯
function showAddExpenseModal() {
    // Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    const form = document.getElementById('expenseForm');
    if (form) {
        form.reset();
    }

    // Clear edit state
    const modal = document.getElementById('expenseModal');
    if (modal.dataset.expenseId) {
        delete modal.dataset.expenseId;
    }

    // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    const modalTitle = document.querySelector('#expenseModal .modal-title');
    if (modalTitle) {
        modalTitle.textContent = isRTL ? 'Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯' : 'Add New Expense';
    }

    // Set default date
    const dateInput = document.getElementById('expenseDate');
    if (dateInput) {
        dateInput.value = new Date().toISOString().split('T')[0];
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    const bootstrapModal = new bootstrap.Modal(modal);
    bootstrapModal.show();

    console.log('ğŸ†• ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯');
}

// Third duplicate export function removed - using main exportExpenses function

// ÙˆØ¸ÙŠÙØ© Ø·Ø¨Ø§Ø¹Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª
function printExpensesList() {
    console.log('ğŸ–¨ï¸ Ø²Ø± Ø·Ø¨Ø§Ø¹Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª ØªÙ… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡');

    try {
        const btn = event.target.closest('button');
        const originalText = btn.innerHTML;

        showLoading(btn, isRTL ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ± Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©...' : 'Preparing for print...');

        console.log('ğŸ–¨ï¸ Ø¨Ø¯Ø¡ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©...');

    setTimeout(() => {
        hideLoading(btn, originalText);
        window.print();
        console.log('ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª');
    }, 1000);
}

// ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø£Ø²Ø±Ø§Ø±
function showLoading(button, text) {
    if (!button) return;
    button.dataset.originalText = button.innerHTML;
    button.disabled = true;
    button.innerHTML = `<i class="fas fa-spinner fa-spin me-1"></i>${text}`;
}

function hideLoading(button, originalText = null) {
    if (!button) return;
    button.disabled = false;
    button.innerHTML = originalText || button.dataset.originalText || button.innerHTML;
}
</script>

<style>
/* ØªØ­Ø³ÙŠÙ† ØªÙ†Ø³ÙŠÙ‚ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª */
#expenses-table {
    font-size: 0.9rem;
}

#expenses-table th {
    background-color: #f8f9fa;
    font-weight: 600;
    border-bottom: 2px solid #dee2e6;
    white-space: nowrap;
}

#expenses-table td {
    vertical-align: middle;
    padding: 0.75rem 0.5rem;
}

/* ØªØ­Ø³ÙŠÙ† ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙÙˆÙ */
#expenses-table tbody tr {
    cursor: pointer;
    transition: background-color 0.2s ease;
}

#expenses-table tbody tr:hover {
    background-color: #f8f9fa !important;
}

#expenses-table tbody tr.table-active {
    background-color: #e3f2fd !important;
    border-left: 4px solid #2196f3;
}

#expenses-table tbody tr input[type="radio"] {
    transform: scale(1.2);
    margin: 0;
}

/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
.btn-group-sm .btn {
    padding: 0.25rem 0.4rem;
    font-size: 0.8rem;
    border-radius: 0.2rem;
}

/* ØªÙ†Ø³ÙŠÙ‚ Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
#expenses-table td:last-child {
    width: 200px;
    min-width: 200px;
}

/* ØªÙ†Ø³ÙŠÙ‚ Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù…Ø¨Ù„Øº */
#expenses-table td.text-end {
    font-weight: 600;
    color: #dc3545;
}

/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø´Ø§Ø±Ø§Øª */
.badge {
    font-size: 0.75rem;
    padding: 0.35em 0.65em;
}

/* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø³Ø§ÙØ§Øª ÙÙŠ Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
.btn-group .btn + .btn {
    margin-left: 0;
}

/* ØªÙ†Ø³ÙŠÙ‚ responsive Ù„Ù„Ø¬Ø¯ÙˆÙ„ */
@media (max-width: 768px) {
    #expenses-table {
        font-size: 0.8rem;
    }

    .btn-group-sm .btn {
        padding: 0.2rem 0.3rem;
        font-size: 0.7rem;
    }

    #expenses-table td:last-child {
        width: 150px;
        min-width: 150px;
    }
}

/* ØªØ­Ø³ÙŠÙ† Ù…Ø¸Ù‡Ø± Ø§Ù„ØµÙ Ø§Ù„Ù…Ø­Ø¯Ø¯ */
.table tbody tr.table-active {
    background-color: #e3f2fd !important;
    border-left: 4px solid #2196f3;
}

.table tbody tr:hover {
    background-color: #f5f5f5;
    cursor: pointer;
}

.table tbody tr.table-active:hover {
    background-color: #e3f2fd !important;
}

/* ØªØ­Ø³ÙŠÙ† Ù…Ø¸Ù‡Ø± radio button */
.table tbody tr input[type="radio"] {
    transform: scale(1.2);
    margin: 0;
}
</style>

<script>
// Global variables
let selectedExpenseId = null;
// isRTL defined above in main script section
let expenses = []; // Array to store expenses data

console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø´Ø§Ø´Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª...');

// Ù…Ø¹Ø§Ù„Ø¬ Ø£Ø®Ø·Ø§Ø¡ JavaScript Ø§Ù„Ø¹Ø§Ù…
window.addEventListener('error', function(e) {
    console.error('âŒ Ø®Ø·Ø£ JavaScript:', e.error);
    console.error('ğŸ“ ÙÙŠ Ø§Ù„Ù…Ù„Ù:', e.filename, 'Ø§Ù„Ø³Ø·Ø±:', e.lineno);
});

// Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ØºÙŠØ± Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
window.addEventListener('unhandledrejection', function(e) {
    console.error('âŒ Ø®Ø·Ø£ Promise ØºÙŠØ± Ù…Ø¹Ø§Ù„Ø¬:', e.reason);
});

// Update button states based on selection
function updateExpenseButtonStates() {
    const hasSelection = selectedExpenseId !== null;

    console.log(`ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø±: hasSelection=${hasSelection}, selectedId=${selectedExpenseId}`);

    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ
    const addBtn = document.querySelector('button[onclick*="showAddExpenseModal"]');
    const editBtn = document.querySelector('button[onclick*="EditExpensesRecord"]');
    const deleteBtn = document.querySelector('button[onclick*="DeleteExpensesRecord"]');
    const exportBtn = document.querySelector('button[onclick*="exportExpenses"]');
    const printBtn = document.querySelector('button[onclick*="printExpensesList"]');

    // Ø£Ø²Ø±Ø§Ø± ØªØ­ØªØ§Ø¬ ØªØ­Ø¯ÙŠØ¯ Ù…ØµØ±ÙˆÙ
    [editBtn, deleteBtn].forEach(btn => {
        if (btn) {
            btn.disabled = !hasSelection;
            if (hasSelection) {
                btn.classList.remove('btn-outline-secondary');
                btn.style.opacity = '1';
                btn.title = btn.title.replace(' (ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù…ØµØ±ÙˆÙ Ø£ÙˆÙ„Ø§Ù‹)', '');
            } else {
                btn.classList.add('btn-outline-secondary');
                btn.style.opacity = '0.6';
                if (!btn.title.includes('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù…ØµØ±ÙˆÙ Ø£ÙˆÙ„Ø§Ù‹')) {
                    btn.title += ' (ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù…ØµØ±ÙˆÙ Ø£ÙˆÙ„Ø§Ù‹)';
                }
            }
        }
    });

    // Ø£Ø²Ø±Ø§Ø± Ù„Ø§ ØªØ­ØªØ§Ø¬ ØªØ­Ø¯ÙŠØ¯ (Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù…ÙØ¹Ù„Ø©)
    [addBtn, exportBtn, printBtn].forEach(btn => {
        if (btn) {
            btn.disabled = false;
            btn.style.opacity = '1';
            btn.classList.remove('btn-outline-secondary');
        }
    });

    console.log(`ğŸ”„ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø±: hasSelection=${hasSelection}, selectedId=${selectedExpenseId}`);
}

// Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙÙˆÙ
document.addEventListener('DOMContentLoaded', function() {
    // Add event listeners for radio button selection
    document.addEventListener('change', function(e) {
        if (e.target.name === 'selected_expense') {
            selectedExpenseId = parseInt(e.target.value);
            updateExpenseButtonStates();

            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙˆÙ
            document.querySelectorAll('.table tbody tr').forEach(r => r.classList.remove('table-active'));

            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù„Ù„ØµÙ Ø§Ù„Ù…Ø­Ø¯Ø¯
            const selectedRow = e.target.closest('tr');
            if (selectedRow) {
                selectedRow.classList.add('table-active');
            }

            console.log(`Selected expense: ${selectedExpenseId}`);

            // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ù…Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØµØ±ÙˆÙ
            const row = e.target.closest('tr');
            const description = row.cells[3]?.textContent?.trim() || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';  // Ø¹Ù…ÙˆØ¯ Ø§Ù„ÙˆØµÙ
            const amount = row.cells[5]?.textContent?.trim() || '0';  // Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù…Ø¨Ù„Øº

            showNotification(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ØµØ±ÙˆÙ ${e.target.dataset.expenseNumber || '#' + selectedExpenseId} | ${description}`, 'info');
        }
    });

    // Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙÙˆÙ Ø¨Ø§Ù„Ù†Ù‚Ø±
    const tableRows = document.querySelectorAll('.table tbody tr');
    tableRows.forEach(row => {
        row.addEventListener('click', function(e) {
            // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            if (e.target.closest('button') || e.target.closest('a')) {
                return;
            }

            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙˆÙ
            tableRows.forEach(r => {
                r.classList.remove('table-active');
                r.style.backgroundColor = '';
                r.style.borderLeft = '';
            });

            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù„Ù„ØµÙ Ø§Ù„Ù…Ø­Ø¯Ø¯
            this.classList.add('table-active');
            this.style.backgroundColor = '#e3f2fd';
            this.style.borderLeft = '4px solid #2196f3';

            // ØªØ­Ø¯ÙŠØ¯ radio button Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„
            const radioButton = this.querySelector('input[name="selected_expense"]');
            if (radioButton) {
                radioButton.checked = true;

                // ØªØ­Ø¯ÙŠØ« Ù…ØªØºÙŠØ± Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„Ù…Ø­Ø¯Ø¯
                selectedExpenseId = parseInt(radioButton.value);
                updateExpenseButtonStates();

                console.log(`Selected expense: ${selectedExpenseId}`);

                // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ù…Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØµØ±ÙˆÙ
                const description = this.cells[3]?.textContent?.trim() || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';  // Ø¹Ù…ÙˆØ¯ Ø§Ù„ÙˆØµÙ
                const amount = this.cells[5]?.textContent?.trim() || '0';  // Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù…Ø¨Ù„Øº

                console.log(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ØµØ±ÙˆÙ: ${radioButton.dataset.expenseNumber || '#' + selectedExpenseId} - ${description} - ${amount}`);
                showNotification(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ØµØ±ÙˆÙ ${radioButton.dataset.expenseNumber || '#' + selectedExpenseId} | ${description}`, 'info');
            }
        });
    });

    // ØªÙ‡ÙŠØ¦Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    updateExpenseButtonStates();

    // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨
    const totalRows = document.querySelectorAll('.table tbody tr').length;
    if (totalRows > 0) {
        console.log(`ğŸ“‹ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø´Ø§Ø´Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø¨Ù†Ø¬Ø§Ø­ - ÙŠÙˆØ¬Ø¯ ${totalRows} Ù…ØµØ±ÙˆÙ`);
        showNotification(`ğŸ“‹ Ø´Ø§Ø´Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø¬Ø§Ù‡Ø²Ø© - ÙŠÙˆØ¬Ø¯ ${totalRows} Ù…ØµØ±ÙˆÙ. Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠ ØµÙ Ù„ØªØ­Ø¯ÙŠØ¯Ù‡.`, 'info');
    } else {
        console.log('ğŸ“‹ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø´Ø§Ø´Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª - Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ±ÙˆÙØ§Øª');
        showNotification('ğŸ“ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ±ÙˆÙØ§Øª. Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ "Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯" Ù„Ù„Ø¨Ø¯Ø¡.', 'info');
    }

    // ØªØ´Ø®ÙŠØµ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    console.log('ğŸ” ØªØ´Ø®ÙŠØµ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ...');

    const buttons = {
        add: document.querySelector('button[onclick*="showAddExpenseModal"]'),
        edit: document.querySelector('button[onclick*="EditExpensesRecord"]'),
        delete: document.querySelector('button[onclick*="DeleteExpensesRecord"]'),
        export: document.querySelector('button[onclick*="exportExpenses"]'),
        print: document.querySelector('button[onclick*="printExpensesList"]')
    };

    Object.entries(buttons).forEach(([name, btn]) => {
        if (btn) {
            console.log(`âœ… Ø²Ø± ${name} Ù…ÙˆØ¬ÙˆØ¯ ÙˆÙ…ØªØµÙ„`);

            // Ø¥Ø¶Ø§ÙØ© event listener Ø¥Ø¶Ø§ÙÙŠ Ù„Ù„ØªØ´Ø®ÙŠØµ
            btn.addEventListener('click', function(e) {
                console.log(`ğŸ–±ï¸ ØªÙ… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± ${name}`);

                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø¯Ø§Ù„Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©
                const functionName = btn.getAttribute('onclick');
                if (functionName) {
                    console.log(`ğŸ”§ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø©: ${functionName}`);
                } else {
                    console.error(`âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯Ø§Ù„Ø© Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø²Ø± ${name}`);
                }
            });

            // ØªÙØ¹ÙŠÙ„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØµØ¯ÙŠØ± ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¯Ø§Ø¦Ù…Ø§Ù‹ (Ù„Ø§ ØªØ­ØªØ§Ø¬ ØªØ­Ø¯ÙŠØ¯)
            if (name === 'export' || name === 'print' || name === 'add') {
                btn.disabled = false;
                btn.style.opacity = '1';
            }
        } else {
            console.error(`âŒ Ø²Ø± ${name} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!`);
        }
    });

    // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    console.log('ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø²Ø±Ø§Ø±...');

    // Ø§Ø®ØªØ¨Ø§Ø± Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©
    const addBtn = document.querySelector('button[onclick*="showAddExpenseModal"]');
    if (addBtn) {
        console.log('âœ… Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¬Ø§Ù‡Ø²');
    } else {
        console.error('âŒ Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
    }

    // Ø§Ø®ØªØ¨Ø§Ø± Ø²Ø± Ø§Ù„ØªØµØ¯ÙŠØ±
    const exportBtn = document.querySelector('button[onclick*="exportExpenses"]');
    if (exportBtn) {
        console.log('âœ… Ø²Ø± Ø§Ù„ØªØµØ¯ÙŠØ± Ø¬Ø§Ù‡Ø²');
    } else {
        console.error('âŒ Ø²Ø± Ø§Ù„ØªØµØ¯ÙŠØ± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
    }

    // Ø§Ø®ØªØ¨Ø§Ø± Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
    const printBtn = document.querySelector('button[onclick*="printExpensesList"]');
    if (printBtn) {
        console.log('âœ… Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¬Ø§Ù‡Ø²');
    } else {
        console.error('âŒ Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
    }

    // Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¨Ø³ÙŠØ·Ø© - Ù†Ø³Ø®Ø© Ù…Ù† ØµÙØ­Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙŠ ØªØ¹Ù…Ù„
    console.log('ğŸ”— Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¨Ø³ÙŠØ·Ø©...');

    const addBtn = document.getElementById('addBtn');
    const editBtn = document.getElementById('editBtn');
    const deleteBtn = document.getElementById('deleteBtn');
    const exportBtn = document.getElementById('exportBtn');
    const printBtn = document.getElementById('printBtn');

    if (addBtn) {
        addBtn.addEventListener('click', addExpense);
        console.log('âœ… ØªÙ… Ø±Ø¨Ø· Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©');
    } else {
        console.error('âŒ Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
    }

    if (editBtn) {
        editBtn.addEventListener('click', editExpense);
        console.log('âœ… ØªÙ… Ø±Ø¨Ø· Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„');
    } else {
        console.error('âŒ Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
    }

    if (deleteBtn) {
        deleteBtn.addEventListener('click', deleteExpense);
        console.log('âœ… ØªÙ… Ø±Ø¨Ø· Ø²Ø± Ø§Ù„Ø­Ø°Ù');
    } else {
        console.error('âŒ Ø²Ø± Ø§Ù„Ø­Ø°Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
    }

    if (exportBtn) {
        exportBtn.addEventListener('click', exportExpenses);
        console.log('âœ… ØªÙ… Ø±Ø¨Ø· Ø²Ø± Ø§Ù„ØªØµØ¯ÙŠØ±');
    } else {
        console.error('âŒ Ø²Ø± Ø§Ù„ØªØµØ¯ÙŠØ± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
    }

    if (printBtn) {
        printBtn.addEventListener('click', printExpenses);
        console.log('âœ… ØªÙ… Ø±Ø¨Ø· Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©');
    } else {
        console.error('âŒ Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
    }

    console.log('âœ… ØªÙ… Ø±Ø¨Ø· Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¨Ø³ÙŠØ·Ø©');
    if (document.getElementById('buttonResults')) {
        document.getElementById('buttonResults').innerHTML = '<div class="badge bg-success">âœ… ØªÙ… Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø±</div>';
    }

    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø´Ø§Ø´Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø¨Ù†Ø¬Ø§Ø­');

    // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨
    const totalRows = document.querySelectorAll('.table tbody tr').length;
    if (totalRows > 0) {
        console.log(`ğŸ“‹ ÙŠÙˆØ¬Ø¯ ${totalRows} Ù…ØµØ±ÙˆÙ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„`);
    } else {
        console.log('ğŸ“ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ±ÙˆÙØ§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„');
    }
});
</script>
{% endblock %}
