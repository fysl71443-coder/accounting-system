{% extends "base_unified.html" %}

{% block title %}
{% if session.get('language', 'ar') == 'ar' %}
Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª - Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©
{% else %}
Expenses - Accounting System
{% endif %}
{% endblock %}

{% block page_title %}
{% if session.get('language', 'ar') == 'ar' %}
    Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª
{% else %}
    Expenses Management
{% endif %}
{% endblock %}

{% block extra_css %}
<style>
    .stats-card {
        transition: transform 0.2s;
    }
    .stats-card:hover {
        transform: translateY(-2px);
    }
    .table-responsive {
        border-radius: 0.375rem;
    }
    .btn-group .btn {
        border-radius: 0.25rem !important;
        margin: 0 1px;
    }

    /* ØªØ­Ø³ÙŠÙ† Ù…Ø¸Ù‡Ø± Ø§Ù„ØµÙ Ø§Ù„Ù…Ø­Ø¯Ø¯ */
    .table tbody tr.table-active {
        background-color: #e3f2fd !important;
        border-left: 4px solid #2196f3;
    }

    .table tbody tr:hover {
        background-color: #f5f5f5;
        cursor: pointer;
    }

    .table tbody tr.table-active:hover {
        background-color: #e3f2fd !important;
    }

    /* ØªØ­Ø³ÙŠÙ† Ù…Ø¸Ù‡Ø± radio button */
    .table tbody tr input[type="radio"] {
        transform: scale(1.2);
        margin: 0;
    }
</style>
{% endblock %}

{% block content %}

<!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card stats-card text-center">
            <div class="card-body">
                <h5 class="card-title text-primary">{{ summary_data.expenses_count }}</h5>
                <p class="card-text">{% if session.get('language', 'ar') == 'ar' %}Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª{% else %}Total Expenses{% endif %}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stats-card text-center">
            <div class="card-body">
                <h5 class="card-title text-success">{{ "%.2f"|format(summary_data.total_expenses) }} Ø±ÙŠØ§Ù„</h5>
                <p class="card-text">{% if session.get('language', 'ar') == 'ar' %}Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº{% else %}Total Amount{% endif %}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stats-card text-center">
            <div class="card-body">
                <h5 class="card-title text-warning">{{ "%.2f"|format(summary_data.pending_expenses) }} Ø±ÙŠØ§Ù„</h5>
                <p class="card-text">{% if session.get('language', 'ar') == 'ar' %}ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹{% else %}Unpaid{% endif %}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stats-card text-center">
            <div class="card-body">
                <h5 class="card-title text-info">{{ "%.2f"|format(summary_data.avg_expense) }} Ø±ÙŠØ§Ù„</h5>
                <p class="card-text">{% if session.get('language', 'ar') == 'ar' %}Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…ØµØ±ÙˆÙ{% else %}Average Expense{% endif %}</p>
            </div>
        </div>
    </div>
</div>

<!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª -->
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">
            {% if session.get('language', 'ar') == 'ar' %}
                Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª
            {% else %}
                Expenses List
            {% endif %}
        </h5>
        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù…Ø«Ù„ Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª -->
        <div class="btn-group" role="group" aria-label="Expense Actions">
            <button type="button"
                    id="btnExpenseSave"
                    class="btn btn-success btn-sm"
                    title="Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯">
                <i class="fas fa-plus me-1"></i>
                Ø¥Ø¶Ø§ÙØ©
            </button>

            <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
            <div class="btn-group me-2" role="group">
                <button type="button"
                        id="btnExpensePrint"
                        class="btn btn-primary"
                        title="Ø·Ø¨Ø§Ø¹Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª">
                    <i class="fas fa-print me-1"></i>
                    Ø·Ø¨Ø§Ø¹Ø©
                </button>
                <button type="button"
                        id="btnExpenseExport"
                        class="btn btn-info"
                        title="ØªØµØ¯ÙŠØ± Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª">
                    <i class="fas fa-download me-1"></i>
                    ØªØµØ¯ÙŠØ±
                </button>
            </div>

            <div class="btn-group" role="group">
                <button type="button"
                        id="btnExpenseEdit"
                        class="btn btn-warning"
                        title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„Ù…Ø­Ø¯Ø¯">
                    <i class="fas fa-edit me-1"></i>
                    ØªØ¹Ø¯ÙŠÙ„
                </button>
                <button type="button"
                        id="btnExpenseDelete"
                        class="btn btn-danger"
                        title="Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„Ù…Ø­Ø¯Ø¯">
                    <i class="fas fa-trash me-1"></i>
                    Ø­Ø°Ù
                </button>
            </div>
        </div>
    </div>
    <div class="card-body">
        <div id="buttonResults" class="mb-3"></div>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>ØªØ­Ø¯ÙŠØ¯</th>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ù…ØµØ±ÙˆÙ</th>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ù„ÙˆØµÙ</th>
                                <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for expense in expenses %}
                            <tr>
                                <td>
                                    <input type="radio" name="selected_expense" value="{{ expense.id }}" 
                                           data-expense-number="{{ expense.expense_number }}">
                                </td>
                                <td>{{ expense.expense_number }}</td>
                                <td>{{ expense.date.strftime('%Y-%m-%d') if expense.date else '-' }}</td>
                                <td>{{ expense.description }}</td>
                                <td class="text-end">{{ "%.2f"|format(expense.amount) }} Ø±ÙŠØ§Ù„</td>
                                <td>
                                    {% if expense.payment_status == 'paid' %}
                                        <span class="badge bg-success">Ù…Ø¯ÙÙˆØ¹</span>
                                    {% else %}
                                        <span class="badge bg-danger">ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-primary" onclick="payExpense({{ expense.id }})">
                                        <i class="fas fa-money-bill-wave"></i>
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ù…ØµØ±ÙˆÙ -->
    <div class="modal fade" id="expenseModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="expenseForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="expenseNumber" class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù…ØµØ±ÙˆÙ</label>
                                    <input type="text" class="form-control" id="expenseNumber" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="expenseDate" class="form-label">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                                    <input type="date" class="form-control" id="expenseDate" required>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="expenseDescription" class="form-label">ÙˆØµÙ Ø§Ù„Ù…ØµØ±ÙˆÙ</label>
                            <input type="text" class="form-control" id="expenseDescription" required>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="expenseAmount" class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº (Ø±ÙŠØ§Ù„)</label>
                                    <input type="number" class="form-control" id="expenseAmount" step="0.01" min="0" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="expenseCategory" class="form-label">Ø§Ù„ÙØ¦Ø©</label>
                                    <select class="form-control" id="expenseCategory">
                                        <option value="Ù…Ø±Ø§ÙÙ‚">Ù…Ø±Ø§ÙÙ‚</option>
                                        <option value="Ø¥ÙŠØ¬Ø§Ø±">Ø¥ÙŠØ¬Ø§Ø±</option>
                                        <option value="Ù…ÙƒØªØ¨ÙŠØ©">Ù…ÙƒØªØ¨ÙŠØ©</option>
                                        <option value="ØµÙŠØ§Ù†Ø©">ØµÙŠØ§Ù†Ø©</option>
                                        <option value="Ù…ÙˆØ§ØµÙ„Ø§Øª">Ù…ÙˆØ§ØµÙ„Ø§Øª</option>
                                        <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="expenseVendor" class="form-label">Ø§Ù„Ù…ÙˆØ±Ø¯/Ø§Ù„Ø¬Ù‡Ø©</label>
                            <input type="text" class="form-control" id="expenseVendor">
                        </div>

                        <div class="mb-3">
                            <label for="expenseNotes" class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                            <textarea class="form-control" id="expenseNotes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
                    <button type="button" class="btn btn-success" id="saveExpenseBtn">Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©...');
        
        // Ø¯ÙˆØ§Ù„ Ø¨Ø³ÙŠØ·Ø© ØªØ¹Ù…Ù„
        function addExpense() {
            console.log('â• Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©');

            try {
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                const modal = document.getElementById('expenseModal');
                if (!modal) {
                    alert('âŒ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…ØµØ±ÙˆÙ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!');
                    return;
                }

                // Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                const form = document.getElementById('expenseForm');
                if (form) {
                    form.reset();
                }

                // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ
                const dateInput = document.getElementById('expenseDate');
                if (dateInput) {
                    dateInput.value = new Date().toISOString().split('T')[0];
                }

                // ØªØ¹ÙŠÙŠÙ† Ø±Ù‚Ù… Ù…ØµØ±ÙˆÙ ØªÙ„Ù‚Ø§Ø¦ÙŠ
                const numberInput = document.getElementById('expenseNumber');
                if (numberInput) {
                    numberInput.value = 'Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹';
                }

                // ÙØªØ­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                const modalInstance = new bootstrap.Modal(modal);
                modalInstance.show();

                console.log('âœ… ØªÙ… ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ');
                document.getElementById('buttonResults').innerHTML += '<div class="badge bg-success me-1">âœ… ÙØªØ­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</div>';

            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ÙØªØ­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬:', error);
                alert('Ø®Ø·Ø£ ÙÙŠ ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…ØµØ±ÙˆÙ: ' + error.message);
            }
        }
        
        function editExpense() {
            console.log('âœï¸ Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„');
            
            const selected = document.querySelector('input[name="selected_expense"]:checked');
            if (selected) {
                alert('âœ… Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙŠØ¹Ù…Ù„! Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„Ù…Ø­Ø¯Ø¯: ' + selected.value);
                document.getElementById('buttonResults').innerHTML += '<div class="badge bg-warning me-1">âœ… ØªØ¹Ø¯ÙŠÙ„</div>';
                
                // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§
                window.location.href = '/expenses/edit/' + selected.value;
            } else {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù…ØµØ±ÙˆÙ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹');
            }
        }
        
        function deleteExpense() {
            console.log('ğŸ—‘ï¸ Ø²Ø± Ø§Ù„Ø­Ø°Ù');

            const selected = document.querySelector('input[name="selected_expense"]:checked');
            if (selected) {
                const expenseId = selected.value;
                const expenseNumber = selected.dataset.expenseNumber || expenseId;

                if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ ${expenseNumber}ØŸ\n\nÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡!`)) {
                    console.log('ğŸš€ Ø¨Ø¯Ø¡ Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ:', expenseId);
                    document.getElementById('buttonResults').innerHTML += '<div class="badge bg-warning me-1">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø°Ù...</div>';

                    // Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø­Ø°Ù Ø§Ù„ÙØ¹Ù„ÙŠ
                    fetch(`/api/expenses/delete/${expenseId}`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    })
                    .then(response => {
                        console.log('ğŸ“¡ Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø®Ø§Ø¯Ù…:', response.status);
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('ğŸ“¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©:', data);
                        if (data.success) {
                            alert(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ ${expenseNumber} Ø¨Ù†Ø¬Ø§Ø­!`);
                            document.getElementById('buttonResults').innerHTML += '<div class="badge bg-success me-1">âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù</div>';

                            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                            setTimeout(() => {
                                location.reload();
                            }, 1000);
                        } else {
                            alert('âŒ ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ: ' + (data.message || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'));
                            document.getElementById('buttonResults').innerHTML += '<div class="badge bg-danger me-1">âŒ ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù</div>';
                        }
                    })
                    .catch(error => {
                        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ:', error);
                        alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ: ' + error.message);
                        document.getElementById('buttonResults').innerHTML += '<div class="badge bg-danger me-1">âŒ Ø®Ø·Ø£</div>';
                    });
                }
            } else {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù…ØµØ±ÙˆÙ Ù„Ù„Ø­Ø°Ù Ø£ÙˆÙ„Ø§Ù‹');
            }
        }
        
        function exportExpenses() {
            console.log('ğŸ“¥ Ø²Ø± Ø§Ù„ØªØµØ¯ÙŠØ±');
            alert('âœ… Ø²Ø± Ø§Ù„ØªØµØ¯ÙŠØ± ÙŠØ¹Ù…Ù„!');
            document.getElementById('buttonResults').innerHTML += '<div class="badge bg-info me-1">âœ… ØªØµØ¯ÙŠØ±</div>';
            
            // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ø§Ù„ØªØµØ¯ÙŠØ± Ù‡Ù†Ø§
            window.open('/api/expenses/export', '_blank');
        }
        
        function printExpenses() {
            console.log('ğŸ–¨ï¸ Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©');
            alert('âœ… Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙŠØ¹Ù…Ù„!');
            document.getElementById('buttonResults').innerHTML += '<div class="badge bg-secondary me-1">âœ… Ø·Ø¨Ø§Ø¹Ø©</div>';
            
            // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù‡Ù†Ø§
            window.print();
        }
        
        function payExpense(expenseId) {
            console.log('ğŸ’° Ø¯ÙØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ:', expenseId);
            alert('Ø³ÙŠØªÙ… ÙØªØ­ ØµÙØ­Ø© Ø¯ÙØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ Ø±Ù‚Ù…: ' + expenseId);
            window.location.href = '/payments/new?expense=' + expenseId;
        }

        // Ø¯Ø§Ù„Ø© Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙ
        function saveExpense() {
            console.log('ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙ');

            const form = document.getElementById('expenseForm');
            const formData = new FormData();

            // Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            formData.append('description', document.getElementById('expenseDescription').value);
            formData.append('amount', document.getElementById('expenseAmount').value);
            formData.append('date', document.getElementById('expenseDate').value);
            formData.append('category', document.getElementById('expenseCategory').value);
            formData.append('vendor', document.getElementById('expenseVendor').value);
            formData.append('notes', document.getElementById('expenseNotes').value);

            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            fetch('/api/expenses/create', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙ Ø¨Ù†Ø¬Ø§Ø­!');

                    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                    const modal = bootstrap.Modal.getInstance(document.getElementById('expenseModal'));
                    modal.hide();

                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                    location.reload();
                } else {
                    alert('âŒ ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙ: ' + data.message);
                }
            })
            .catch(error => {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙ:', error);
                alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙ');
            });
        }
        
        // Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”— Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©...');

            // Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            const addBtn = document.getElementById('btnExpenseSave');
            const editBtn = document.getElementById('btnExpenseEdit');
            const deleteBtn = document.getElementById('btnExpenseDelete');
            const exportBtn = document.getElementById('btnExpenseExport');
            const printBtn = document.getElementById('btnExpensePrint');
            const saveBtn = document.getElementById('saveExpenseBtn');

            if (addBtn) {
                addBtn.addEventListener('click', addExpense);
                console.log('âœ… ØªÙ… Ø±Ø¨Ø· Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©');
            }

            if (editBtn) {
                editBtn.addEventListener('click', editExpense);
                console.log('âœ… ØªÙ… Ø±Ø¨Ø· Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„');
            }

            if (deleteBtn) {
                deleteBtn.addEventListener('click', deleteExpense);
                console.log('âœ… ØªÙ… Ø±Ø¨Ø· Ø²Ø± Ø§Ù„Ø­Ø°Ù');
            }

            if (exportBtn) {
                exportBtn.addEventListener('click', exportExpenses);
                console.log('âœ… ØªÙ… Ø±Ø¨Ø· Ø²Ø± Ø§Ù„ØªØµØ¯ÙŠØ±');
            }

            if (printBtn) {
                printBtn.addEventListener('click', printExpenses);
                console.log('âœ… ØªÙ… Ø±Ø¨Ø· Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©');
            }

            if (saveBtn) {
                saveBtn.addEventListener('click', saveExpense);
                console.log('âœ… ØªÙ… Ø±Ø¨Ø· Ø²Ø± Ø§Ù„Ø­ÙØ¸');
            }

            console.log('âœ… ØªÙ… Ø±Ø¨Ø· Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±');
            document.getElementById('buttonResults').innerHTML = '<div class="badge bg-success">âœ… ØªÙ… Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø±</div>';
        });
    </script>
{% endblock %}

{% block scripts %}
<script>
// Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ø³ÙƒØ±ÙŠØ¨Øª Ø¥Ø¶Ø§ÙÙŠ Ù‡Ù†Ø§ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
console.log('ğŸ“‹ Ø´Ø§Ø´Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø¬Ø§Ù‡Ø²Ø©');
</script>
{% endblock %}
